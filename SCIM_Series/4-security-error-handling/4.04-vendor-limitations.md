# 🏆 Section 4.04 | Security & Error Handling | “Vendor Limitations”

---

## 📌 At a glance
Even though SCIM is standardized, **vendors often implement only a subset** of the spec.  
Vendor limitations affect how PATCH, filters, groups, and deletes work in practice.  

---

## 📖 What are Vendor Limitations?
These are **gaps, variations, or deviations** in SCIM implementations between different SaaS providers.  
They often appear in `/ServiceProviderConfig` or through trial-and-error during integration.

> **Notes**
- SCIM RFCs (7643 & 7644) allow flexibility → vendors pick subsets.  
- `/ServiceProviderConfig` reveals supported features (PATCH, Bulk, filters, etc).  
- Limitations impact provisioning flows and must be handled explicitly.  

---

## 🔑 Key characteristics
- **Partial PATCH support** → Some vendors only allow PUT or limited PATCH ops.  
- **Filter restrictions** → Only `eq` supported; others like `co`/`sw`/`ew` rejected.  
- **Group membership quirks** → Require IDs, not userName; some don’t support nested groups.  
- **Bulk not supported** → Many vendors reject `/Bulk` entirely.  
- **Soft delete vs hard delete** → Some set `active:false`; others purge data.  
- **Attribute differences** → Vendor-specific extensions or missing attributes.  

---

## 🌍 Why it matters (and how it helps you later)
- Vendor limitations are **the #1 reason SCIM integrations break**.  
- Awareness lets you design **workarounds, fallbacks, and retries**.  
- As an IAM engineer, you’ll always confirm capabilities before rollout.  
- Critical for **audits, deprovisioning assurance, and license savings**.  

---

## 🛠️ Where it’s used (flows + impact)

### Example Flow
```
Okta → SCIM PATCH /Users → SaaS App
```
- If PATCH unsupported → 400 error.  
- Workaround → Use PUT (replace full object).  

Impact: Without checking vendor limits, movers fail silently, leaving stale data.  

---

## 🔗 How this links to other concepts
- [4.03 Common Failures](4.03-common-failures.md) → Vendor limitations are the root of many recurring failures.  
- [5.02 Building SCIM Server](../5-real-world-implementation/5.02-building-scim-server.md) → When building, you must document supported operations.  
- [5.03 Troubleshooting](../5-real-world-implementation/5.03-troubleshooting.md) → Vendor quirks are often discovered during debugging.  

---

## ⚙️ Technical deep dive

### Example: `/ServiceProviderConfig` revealing limits
```json
{
  "patch": { "supported": false },
  "bulk": { "supported": false },
  "filter": { "supported": true, "maxResults": 100 },
  "changePassword": { "supported": false },
  "sort": { "supported": true }
}
```
**Key points**:  
- PATCH not supported → must use PUT.  
- Bulk not supported → provision one by one.  
- Max results 100 → pagination required.  

### Example: Group membership requiring ID
```http
PATCH /Groups/12345
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations":[{
    "op":"add",
    "path":"members",
    "value":[{"value":"2819c223-7f76-453a-919d-413861904646"}]
  }]
}
```
**Key points**:  
- Must use SCIM `id`, not `userName`.  
- Some vendors reject if the user hasn’t been created first.  

---

## 🏢 Real-world scenario
A customer tried to sync 50k accounts into a SaaS vendor using Bulk.  

- Vendor did not support `/Bulk`, job failed.  
- Workaround: Batched single `POST /Users` requests with retry logic.  

**Impact:** Integration went from failing completely to stable, but at higher latency.  

---

## ❌ Common pitfalls
- Assuming PATCH is always supported.  
- Writing filters with `co` or `sw` when only `eq` is allowed.  
- Using userName instead of ID in groups.  
- Expecting Bulk operations without checking.  
- Not documenting vendor-specific schema extensions.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Unsupported PATCH | Movers fail | Use PUT with caution |
| No Bulk support | Slow provisioning | Build retry logic and batching |
| Filter restrictions | Failed queries | Limit to supported operators |
| Group membership rules | Wrong references | Always use SCIM `id` not `userName` |
| Hard deletes only | Lost audit trail | Implement shadow disable logic |

**Real-world:** An app vendor purged user accounts on DELETE with no recovery. Switching to `PATCH active:false` preserved compliance evidence.  

---

## 📝 Mini quiz
1. Which SCIM endpoint reveals vendor capability support?  
   a) `/Schemas`  
   b) `/ServiceProviderConfig`  
   c) `/ResourceTypes`  
   d) `/Bulk`  

2. Scenario: Your `PATCH /Users` fails because the vendor does not support it. What’s your fallback?  
   a) Use `DELETE`  
   b) Use `PUT` with full object replace  
   c) Use `/Bulk`  
   d) Use Basic Auth  

3. Which vendor limitation is most likely if filters with `co` or `sw` fail?  
   a) Bulk not supported  
   b) Attribute mismatch  
   c) Filter restriction to `eq` only  
   d) Missing `externalId`  

---

## 🔗 Navigation
👉 Back: [4.03 Common Failures](4.03-common-failures.md)  
👉 Next: [5.01 Using Postman](../5-real-world-implementation/5.01-using-postman.md)  

➡️ Next, we’ll explore **Using Postman (5.01)** to practice SCIM calls and validate vendor behavior hands-on.
