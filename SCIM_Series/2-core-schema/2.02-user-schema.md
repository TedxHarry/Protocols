# ğŸ† Section 2.02 | Core Schema | â€œUser Schemaâ€

---

## ğŸ“Œ At a glance
The **User Schema** defines the standard structure for representing users in SCIM.  
It lists the **required and optional attributes** that must be supported by any SCIM-compliant system.  

---

## ğŸ“– What is the User Schema?
The User Schema is the **default blueprint for user accounts** in SCIM.  
It provides a consistent way to describe individuals across identity providers and service providers.  

> **Notes**
- Defined in **RFC 7643 (SCIM Core Schema)**.  
- Every SCIM user must follow this schema.  
- `userName` is the only strictly required attribute.  

---

## ğŸ”‘ Key characteristics
- **Mandatory core fields** â†’ `userName`, `id`, `schemas`.  
- **Complex attributes** â†’ `name`, `emails`, `phoneNumbers`, `addresses`.  
- **Multi-valued support** â†’ emails, phoneNumbers, groups can hold multiple entries.  
- **Enterprise extension ready** â†’ can add job title, costCenter, manager, etc.  
- **Interoperability** â†’ ensures apps can read/write user data consistently.  
- **Supports partial updates** â†’ via PATCH for specific attributes.  

---

## ğŸŒ Why it matters (and how it helps you later)
- Attribute-level knowledge helps you **map HR fields â†’ app fields** correctly.  
- Errors in mapping lead to **failed provisioning, duplicate accounts, or wrong entitlements**.  
- IAM engineers must understand which attributes are **required, optional, and multi-valued** to troubleshoot effectively.  
- This prepares you for deeper dives into **attribute filtering, selection, and custom schema extensions**.  

---

## ğŸ› ï¸ Where itâ€™s used (flows + impact)

### Flow Example
```
HR System Attributes â†’ SCIM User Schema â†’ Application Attributes
```

- `givenName` â†’ `firstName` in app.  
- `familyName` â†’ `lastName` in app.  
- `emails.value` â†’ `email` in app.  
- `userName` â†’ `login` in app.  

Impact: Proper mapping ensures **seamless provisioning**. Wrong mapping causes login failures or duplicate accounts.  

---

## ğŸ”— How this links to other concepts
- [2.01 Core Schema Overview](2.01-core-schema-overview.md) â†’ Introduced the schema concept; this file dives into the User schema in detail.  
- [2.03 Group Schema](2.03-group-schema.md) â†’ Complements the User schema for managing memberships.  
- [2.04 Enterprise Extension](2.04-enterprise-extension.md) â†’ Expands the User schema with enterprise-specific attributes.  

---

## âš™ï¸ Technical deep dive

### Attribute table (core User schema)

| Attribute | Required | Type | Multi-valued | Notes |
|-----------|----------|------|---------------|-------|
| `id` | Yes | string | No | Unique identifier (server-assigned). |
| `externalId` | No | string | No | Client-assigned ID, useful for HR mapping. |
| `userName` | Yes | string | No | Unique login identifier. |
| `name` | No | complex | No | Structured: `givenName`, `familyName`. |
| `displayName` | No | string | No | Human-readable name. |
| `nickName` | No | string | No | Informal name. |
| `profileUrl` | No | string | No | URL to userâ€™s profile page. |
| `emails` | No | complex | Yes | `value`, `type`, `primary`. |
| `phoneNumbers` | No | complex | Yes | `value`, `type`. |
| `addresses` | No | complex | Yes | Street, locality, region, postalCode. |
| `groups` | No | complex | Yes | List of groups the user belongs to. |
| `active` | No | boolean | No | Indicates if the account is active. |
| `meta` | Yes | complex | No | Contains `created`, `lastModified`, `version`. |

### Example: User creation
```json
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "jdoe",
  "name": { "givenName": "John", "familyName": "Doe" },
  "emails": [{ "value": "jdoe@example.com", "primary": true }],
  "active": true
}
```

**Key mapping tips**:  
- Always map HR `employeeID` â†’ SCIM `externalId`.  
- Map `workEmail` â†’ `emails.value`.  
- For login consistency, use **email or UPN** in `userName`.  
- Always ensure `active` is handled correctly for leaver flows.  

---

## ğŸ¢ Real-world scenario
An enterprise integrates Workday (HR) with ServiceNow via SCIM.  

- Without schema alignment: Workday `Employee_ID` wasnâ€™t mapped to `externalId`. Duplicate accounts created in ServiceNow.  
- With proper mapping: `Employee_ID` â†’ `externalId` ensured exact identity matching.  

**Impact:** Duplicate accounts eliminated, compliance risk reduced.  

---

## âŒ Common pitfalls
- Forgetting `schemas` array â†’ request rejected.  
- Not mapping `externalId` â†’ duplicate accounts.  
- Using inconsistent case in `userName`.  
- Not setting `primary:true` in multi-valued attributes like `emails`.  
- Over-mapping HR fields into custom schema instead of using standard attributes.  

---

## âš ï¸ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Duplicate accounts | Login conflicts, audit failures | Map `externalId` properly |
| Missing `userName` | Requests rejected | Always provide `userName` |
| Wrong primary email flag | Login or notification failures | Ensure `emails.primary=true` set correctly |
| Schema drift | Incompatibility across apps | Validate mapping during testing |

**Real-world:** A companyâ€™s IdP mapped HRâ€™s `workEmail` to SCIM `nickName` instead of `emails.value`, breaking app logins.  

---

## ğŸ“ Mini quiz
1. Which SCIM attribute must always be present in a User object?  
   a) `externalId`  
   b) `userName`  
   c) `displayName`  
   d) `nickName`  

2. Which attribute is most important for preventing duplicate accounts during provisioning?  
   a) `id`  
   b) `externalId`  
   c) `meta.version`  
   d) `profileUrl`  

3. Scenario: An app rejects all new user requests because the `schemas` array is missing. Whatâ€™s the root cause?  
   a) Schema drift  
   b) Missing mandatory attribute  
   c) Wrong `externalId` mapping  
   d) Invalid PATCH operation  

---

## ğŸ”— Navigation
ğŸ‘‰ Back: [2.01 Core Schema Overview](2.01-core-schema-overview.md)  
ğŸ‘‰ Next: [2.03 Group Schema](2.03-group-schema.md)
