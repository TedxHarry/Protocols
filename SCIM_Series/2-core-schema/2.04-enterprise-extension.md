# ğŸ† Section 2.04 | Core Schema | â€œEnterprise Extensionâ€

---

## ğŸ“Œ At a glance
The **Enterprise User Schema Extension** expands the SCIM User schema with **workplace-specific attributes**.  
It standardizes fields like job title, manager, and cost center, which are critical in enterprise provisioning and governance.  

---

## ğŸ“– What is the Enterprise Extension?
The Enterprise Extension is an **optional SCIM schema** that defines attributes commonly required in corporate environments.  
It ensures that **business context attributes** (e.g., department, employee number, manager) are modeled consistently across vendors.

> **Notes**
- Defined in **RFC 7643, Section 4.3 (Enterprise User Extension)**.  
- Schema URN: `urn:ietf:params:scim:schemas:extension:enterprise:2.0:User`.  
- Attributes include: `employeeNumber`, `costCenter`, `organization`, `division`, `department`, `manager`.  

---

## ğŸ”‘ Key characteristics
- **Business-focused attributes** â†’ Align SCIM with enterprise HR systems.  
- **Extension-based** â†’ Added to the core User schema, not a replacement.  
- **Manager object** â†’ Special nested attribute referencing another User.  
- **Widely supported** â†’ Okta, Azure Entra ID, and other IdPs map HR data into this extension.  
- **Governance value** â†’ Enables policy enforcement based on org structure.  
- **Extensible** â†’ Can be combined with custom schemas.  

---

## ğŸŒ Why it matters (and how it helps you later)
- Most real-world IAM projects require **HR attributes** beyond the core schema.  
- Enterprise extension ensures **standardization** instead of each vendor defining their own.  
- Itâ€™s critical for:  
  - **Role-based access control (RBAC)** â†’ Map roles based on department/division.  
  - **Audit & compliance** â†’ Track manager relationships for approvals.  
  - **Workflow automation** â†’ Route requests based on cost center or org unit.  

---

## ğŸ› ï¸ Where itâ€™s used (flows + impact)

### Flow Example
```
HR â†’ IdP â†’ SCIM Enterprise Extension â†’ SaaS App
```

- HR sets manager + department â†’ SCIM passes attributes.  
- App applies role templates automatically (e.g., Engineering â†’ DevOps role).  
- Manager field drives approval workflows.  

Impact: Automates access assignment based on org metadata instead of manual role assignment.  

---

## ğŸ”— How this links to other concepts
- [2.02 User Schema](2.02-user-schema.md) â†’ Core attributes + enterprise extension = complete user object.  
- [2.05 Custom Extensions](2.05-custom-extensions.md) â†’ If enterprise extension is not enough, create vendor-specific schemas.  
- [5.03 Troubleshooting](../5-real-world-implementation/5.03-troubleshooting.md) â†’ Many provisioning failures trace back to **enterprise attribute mismapping**.  

---

## âš™ï¸ Technical deep dive

### Attribute table (Enterprise Extension)

| Attribute | Type | Notes |
|-----------|------|-------|
| `employeeNumber` | string | Identifier assigned by HR (not login ID). |
| `costCenter` | string | Used for financial tracking. |
| `organization` | string | Company name. |
| `division` | string | High-level business unit. |
| `department` | string | Department name. |
| `manager` | complex | Contains `value` (User id) and `displayName`. |

### Example: User with enterprise extension
```json
{
  "schemas": [
    "urn:ietf:params:scim:schemas:core:2.0:User",
    "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User"
  ],
  "userName": "jsmith",
  "name": { "givenName": "John", "familyName": "Smith" },
  "emails": [{ "value": "jsmith@example.com", "primary": true }],
  "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User": {
    "employeeNumber": "E12345",
    "costCenter": "CC-100",
    "department": "Engineering",
    "manager": {
      "value": "2819c223-7f76-453a-919d-413861904646",
      "displayName": "Jane Doe"
    }
  }
}
```

**Key points**:  
- Extension schema is included in `schemas` array.  
- Attributes are grouped under their URN namespace.  
- `manager.value` should point to the managerâ€™s **User id** in the SP.  

---

## ğŸ¢ Real-world scenario
A global bank uses Workday HR as source of truth.  

- HR data includes `employeeNumber`, `department`, and `manager`.  
- Through SCIM, Azure Entra ID provisions SaaS apps (Salesforce, ServiceNow).  
- Access policies assign roles based on **department** (e.g., Engineering vs Finance).  
- Approval workflows use `manager` attribute for access requests.  

**Impact:** Automated access assignment and approvals reduced manual IT workload by 70%.  

---

## âŒ Common pitfalls
- Forgetting to include extension URN in `schemas` array.  
- Mapping `employeeNumber` incorrectly (e.g., as `id`).  
- Not ensuring manager references exist in the target system.  
- Overloading extension attributes with values that belong in custom extensions.  

---

## âš ï¸ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Missing enterprise extension URN | Extension attributes ignored | Always include URN in `schemas` |
| Incorrect manager references | Broken approval flows | Ensure referenced user IDs exist |
| Over-reliance on department mappings | Over-provisioning | Validate mappings during testing |
| Inconsistent HR data | Downstream provisioning errors | Clean HR data before sync |

**Real-world:** A company misconfigured `employeeNumber` as login ID. Thousands of duplicate accounts were created across SaaS apps.  

---

## ğŸ“ Mini quiz
1. What is the schema URN for the SCIM enterprise extension?  
   a) `urn:ietf:params:scim:schemas:core:2.0:Enterprise`  
   b) `urn:ietf:params:scim:schemas:extension:enterprise:2.0:User`  
   c) `urn:scim:params:enterprise:core:2.0:User`  
   d) `urn:ietf:params:scim:schemas:enterprise:2.0:User`  

2. Which enterprise extension attribute is used for approval workflows?  
   a) `division`  
   b) `manager`  
   c) `organization`  
   d) `employeeNumber`  

3. Scenario: A provisioning request includes `department` but no extension URN. What happens?  
   a) Request fails immediately.  
   b) Attribute is ignored.  
   c) It maps automatically.  
   d) It replaces `displayName`.  

---

## ğŸ”— Navigation
ğŸ‘‰ Back: [2.03 Group Schema](2.03-group-schema.md)  
ğŸ‘‰ Next: [2.05 Custom Extensions](2.05-custom-extensions.md)
