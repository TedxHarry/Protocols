# 🏆 Section 2.05 | Core Schema | “Custom Extensions”

---

## 📌 At a glance
Custom extensions allow organizations to **go beyond the SCIM core and enterprise schemas** by defining their own attributes.  
They are essential when business requirements demand attributes not covered in the standard schema.  

---

## 📖 What are Custom Extensions?
A custom extension is a **namespace-specific schema** that extends SCIM with additional attributes.  
It follows the same structural rules as the core schema but uses a **unique URN** to prevent conflicts.

> **Notes**
- Must include a **unique URN** (often vendor-specific).  
- Extension attributes are grouped under their URN.  
- Should only be used when core + enterprise schemas are insufficient.  

---

## 🔑 Key characteristics
- **Flexibility** → Add organization-specific or vendor-specific attributes.  
- **Scoped namespace** → Attributes live under a unique URN.  
- **Compatibility** → Follows same rules as core schema (required/optional, type, multivalued).  
- **Vendor-driven** → Many SaaS vendors define their own extensions.  
- **Interoperability risk** → Overuse of custom extensions reduces portability.  
- **Governance impact** → Must be documented and standardized internally.  

---

## 🌍 Why it matters (and how it helps you later)
- Real-world provisioning often requires **non-standard attributes** like building location, badge ID, or license type.  
- Custom extensions allow you to **deliver business requirements** while still using SCIM.  
- As an IAM engineer, you must balance **flexibility vs interoperability**: use custom extensions only when necessary.  
- Career payoff: You’ll often troubleshoot provisioning failures caused by **misaligned custom attributes**.  

---

## 🛠️ Where it’s used (flows + impact)

### Example Flow
```
HR → IdP → SCIM Custom Extension → SaaS App
```

- HR includes custom field (e.g., “BadgeID”).  
- IdP sends it via SCIM under a custom URN.  
- SaaS app consumes it for building access or license allocation.  

Impact: Business-specific needs are met without breaking SCIM compliance.  

---

## 🔗 How this links to other concepts
- [2.04 Enterprise Extension](2.04-enterprise-extension.md) → Use enterprise extension first; fall back to custom extensions only when necessary.  
- [3.07 Attribute Selection](../3-protocol-operations/3.07-attribute-selection.md) → Lets you select/omit attributes, including custom ones.  
- [5.04 Vendor-Specific Notes](../5-real-world-implementation/5.04-vendor-specific-notes.md) → Many vendor quirks revolve around custom extension handling.  

---

## ⚙️ Technical deep dive

### Example: Custom extension for badge ID
```json
{
  "schemas": [
    "urn:ietf:params:scim:schemas:core:2.0:User",
    "urn:ietf:params:scim:schemas:extension:enterprise:2.0:User",
    "urn:example:params:scim:schemas:extension:badge:2.0:User"
  ],
  "userName": "mgarcia",
  "emails": [{ "value": "mgarcia@example.com", "primary": true }],
  "urn:example:params:scim:schemas:extension:badge:2.0:User": {
    "badgeId": "B1234567",
    "building": "HQ-North"
  }
}
```

**Key points**:  
- Custom extension must define its own **URN namespace**.  
- Attributes are grouped under this namespace.  
- Same rules apply: data types, required/optional, multivalued.  

---

## 🏢 Real-world scenario
A healthcare company extends SCIM with a custom schema for **license numbers**.  

- Doctors must have medical license stored in SaaS apps.  
- Custom extension adds `licenseNumber` under a unique URN.  
- SaaS apps use it for role validation and compliance checks.  

**Impact:** Company met regulatory requirements without breaking SCIM compliance.  

---

## ❌ Common pitfalls
- Over-using custom extensions instead of leveraging enterprise attributes.  
- Forgetting to include custom URN in `schemas` array → attributes ignored.  
- Poor documentation → downstream apps can’t parse attributes.  
- Creating overlapping custom attributes across vendors.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Vendor lock-in | Attributes only work with one vendor | Standardize internally; limit use of custom extensions |
| Schema drift | Inconsistent attribute usage | Maintain schema governance docs |
| Missing URN | Attributes dropped silently | Always include URN in `schemas` array |
| Overlapping extensions | Confusion in mappings | Assign clear namespaces and manage centrally |

**Real-world:** A company defined two different custom extensions for “BadgeID” across two apps, leading to inconsistent provisioning and broken workflows.  

---

## 📝 Mini quiz
1. What is required when defining a custom SCIM extension?  
   a) Unique URN  
   b) LDAP schema  
   c) SAML assertion  
   d) Enterprise ID  

2. Which risk increases with heavy use of custom extensions?  
   a) Audit evidence loss  
   b) Vendor lock-in  
   c) Faster provisioning  
   d) Stronger security  

3. Scenario: A provisioning request contains a custom attribute but no URN. What happens?  
   a) The attribute is rejected.  
   b) The attribute is ignored.  
   c) The attribute maps automatically.  
   d) The user creation fails completely.  

---

## 🔗 Navigation
👉 Back: [2.04 Enterprise Extension](2.04-enterprise-extension.md)  
👉 Next: [3.01 Protocol Overview](../3-protocol-operations/3.01-protocol-overview.md)
