# 🏆 Section 2.02 | Core Schema | “User Schema”

---

## 📌 At a glance
The **User Schema** defines the standard structure for representing users in SCIM.  
It lists the **required and optional attributes** that must be supported by any SCIM-compliant system.  

---

## 📖 What is the User Schema?
The User Schema is the **default blueprint for user accounts** in SCIM.  
It provides a consistent way to describe individuals across identity providers and service providers.  

> **Notes**
- Defined in **RFC 7643 (SCIM Core Schema)**.  
- Every SCIM user must follow this schema.  
- `userName` is the only strictly required attribute.  

---

## 🔑 Key characteristics
- **Mandatory core fields** → `userName`, `id`, `schemas`.  
- **Complex attributes** → `name`, `emails`, `phoneNumbers`, `addresses`.  
- **Multi-valued support** → emails, phoneNumbers, groups can hold multiple entries.  
- **Enterprise extension ready** → can add job title, costCenter, manager, etc.  
- **Interoperability** → ensures apps can read/write user data consistently.  
- **Supports partial updates** → via PATCH for specific attributes.  

---

## 🌍 Why it matters (and how it helps you later)
- Attribute-level knowledge helps you **map HR fields → app fields** correctly.  
- Errors in mapping lead to **failed provisioning, duplicate accounts, or wrong entitlements**.  
- IAM engineers must understand which attributes are **required, optional, and multi-valued** to troubleshoot effectively.  
- This prepares you for deeper dives into **attribute filtering, selection, and custom schema extensions**.  

---

## 🛠️ Where it’s used (flows + impact)

### Flow Example
```
HR System Attributes → SCIM User Schema → Application Attributes
```

- `givenName` → `firstName` in app.  
- `familyName` → `lastName` in app.  
- `emails.value` → `email` in app.  
- `userName` → `login` in app.  

Impact: Proper mapping ensures **seamless provisioning**. Wrong mapping causes login failures or duplicate accounts.  

---

## 🔗 How this links to other concepts
- [2.01 Core Schema Overview](2.01-core-schema-overview.md) → Introduced the schema concept; this file dives into the User schema in detail.  
- [2.03 Group Schema](2.03-group-schema.md) → Complements the User schema for managing memberships.  
- [2.04 Enterprise Extension](2.04-enterprise-extension.md) → Expands the User schema with enterprise-specific attributes.  

---

## ⚙️ Technical deep dive

### Attribute table (core User schema)

| Attribute | Required | Type | Multi-valued | Notes |
|-----------|----------|------|---------------|-------|
| `id` | Yes | string | No | Unique identifier (server-assigned). |
| `externalId` | No | string | No | Client-assigned ID, useful for HR mapping. |
| `userName` | Yes | string | No | Unique login identifier. |
| `name` | No | complex | No | Structured: `givenName`, `familyName`. |
| `displayName` | No | string | No | Human-readable name. |
| `nickName` | No | string | No | Informal name. |
| `profileUrl` | No | string | No | URL to user’s profile page. |
| `emails` | No | complex | Yes | `value`, `type`, `primary`. |
| `phoneNumbers` | No | complex | Yes | `value`, `type`. |
| `addresses` | No | complex | Yes | Street, locality, region, postalCode. |
| `groups` | No | complex | Yes | List of groups the user belongs to. |
| `active` | No | boolean | No | Indicates if the account is active. |
| `meta` | Yes | complex | No | Contains `created`, `lastModified`, `version`. |

### Example: User creation
```json
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "jdoe",
  "name": { "givenName": "John", "familyName": "Doe" },
  "emails": [{ "value": "jdoe@example.com", "primary": true }],
  "active": true
}
```

**Key mapping tips**:  
- Always map HR `employeeID` → SCIM `externalId`.  
- Map `workEmail` → `emails.value`.  
- For login consistency, use **email or UPN** in `userName`.  
- Always ensure `active` is handled correctly for leaver flows.  

---

## 🏢 Real-world scenario
An enterprise integrates Workday (HR) with ServiceNow via SCIM.  

- Without schema alignment: Workday `Employee_ID` wasn’t mapped to `externalId`. Duplicate accounts created in ServiceNow.  
- With proper mapping: `Employee_ID` → `externalId` ensured exact identity matching.  

**Impact:** Duplicate accounts eliminated, compliance risk reduced.  

---

## ❌ Common pitfalls
- Forgetting `schemas` array → request rejected.  
- Not mapping `externalId` → duplicate accounts.  
- Using inconsistent case in `userName`.  
- Not setting `primary:true` in multi-valued attributes like `emails`.  
- Over-mapping HR fields into custom schema instead of using standard attributes.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Duplicate accounts | Login conflicts, audit failures | Map `externalId` properly |
| Missing `userName` | Requests rejected | Always provide `userName` |
| Wrong primary email flag | Login or notification failures | Ensure `emails.primary=true` set correctly |
| Schema drift | Incompatibility across apps | Validate mapping during testing |

**Real-world:** A company’s IdP mapped HR’s `workEmail` to SCIM `nickName` instead of `emails.value`, breaking app logins.  

---

## 📝 Mini quiz
1. Which SCIM attribute must always be present in a User object?  
   a) `externalId`  
   b) `userName`  
   c) `displayName`  
   d) `nickName`  

2. Which attribute is most important for preventing duplicate accounts during provisioning?  
   a) `id`  
   b) `externalId`  
   c) `meta.version`  
   d) `profileUrl`  

3. Scenario: An app rejects all new user requests because the `schemas` array is missing. What’s the root cause?  
   a) Schema drift  
   b) Missing mandatory attribute  
   c) Wrong `externalId` mapping  
   d) Invalid PATCH operation  

---

## 🔗 Navigation
👉 Back: [2.01 Core Schema Overview](2.01-core-schema-overview.md)  
👉 Next: [2.03 Group Schema](2.03-group-schema.md)
