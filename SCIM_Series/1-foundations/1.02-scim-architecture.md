# 🏆 Section 1.02 | Foundations | “SCIM Architecture”

---

## 📌 At a glance
SCIM architecture describes **how identity data flows** between the Identity Provider (IdP) and Service Providers (SPs) using standardized schemas and REST APIs.  
It defines the **roles, endpoints, and communication patterns** that make SCIM work reliably across different systems.  

---

## 📖 What is SCIM Architecture?
SCIM architecture provides the **structural model** for provisioning. It defines the client-server relationship:  
- The **IdP (or client)** issues SCIM requests.  
- The **SP (or server)** implements SCIM endpoints and enforces changes.  

> **Notes**
- IdP = Client, SP = Server in SCIM context.  
- Common endpoints: `/Users`, `/Groups`, `/Schemas`, `/ServiceProviderConfig`.  
- Uses REST + JSON over HTTPS for transport.  

---

## ❗ Problem before SCIM Architecture
- Vendors implemented **custom provisioning flows**, each with unique APIs.  
- No consistent distinction between **identity source (client)** and **application (server)**.  
- Hard to standardize joiner/mover/leaver flows.  
- Resulted in brittle, one-off integrations that were difficult to maintain.  

---

## 🔑 Key characteristics
- **Client-Server Model** → IdP acts as client; SP exposes SCIM server endpoints.  
- **Resource-Oriented** → Every identity object (User/Group) is a resource with CRUD operations.  
- **Discoverable** → `/ServiceProviderConfig` tells what features the SP supports.  
- **Schema-driven** → Resources validated against SCIM schema definitions.  
- **Transport** → HTTPS + REST + JSON for simple, secure communication.  
- **Extensible** → Enterprises can add custom schemas without breaking compatibility.  

---

## 🌍 Why it matters (and how it helps you later)
- SCIM architecture helps you visualize **how provisioning works end-to-end**.  
- Clarifies the **roles** of IdP vs SP → a must-know before learning protocol operations.  
- Ensures you understand where **schemas** and **endpoints** fit in.  
- Career-wise, it prepares you to design or troubleshoot **real SCIM integrations** between HR → IdP → App.  

---

## 🛠️ Where it’s used (flows + impact)

### ASCII Flow
```
[HR System] → [IdP / SCIM Client] → [SCIM Server / App]
      Hire →      POST /Users     →   Creates new account
    Transfer →     PATCH /Users   →   Updates attributes
 Termination → DELETE or PATCH    →   Deactivates account
```

- **Joiner**: IdP → `POST /Users` → new account in SP.  
- **Mover**: IdP → `PATCH /Users` → updates department/role.  
- **Leaver**: IdP → `PATCH active:false` → disables account.  

**With SCIM Architecture:**  
- Communication roles are **standardized**.  
- IdP doesn’t need to learn SP internals — just speak SCIM.  
- Apps advertise capabilities via `/ServiceProviderConfig`.  

---

## 🔗 How this links to other concepts
- [1.01 What is SCIM?](1.01-what-is-scim.md) → Introduced SCIM as a protocol; now you see **how roles and endpoints interact**.  
- [1.03 Core Objects](1.03-core-objects.md) → Next, we dive into **Users and Groups**, the objects SCIM architecture manages.  
- [3.02 Endpoints](../3-protocol-operations/3.02-endpoints.md) → Later, you’ll explore **every endpoint in detail**, starting from this architectural view.  

---

## ⚙️ Technical deep dive

### Example: Discover SCIM server capabilities
```http
GET /ServiceProviderConfig
Content-Type: application/scim+json
```
**Response Example:**
```json
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:ServiceProviderConfig"],
  "patch": { "supported": true },
  "bulk": { "supported": false },
  "filter": { "supported": true, "maxResults": 200 },
  "authenticationSchemes": [
    { "type": "oauthbearertoken", "name": "OAuth Bearer Token" }
  ]
}
```
**Key points**:  
- Tells whether **PATCH, bulk, filtering** are supported.  
- Lists supported **authentication schemes**.  

### Example: Basic User fetch
```http
GET /Users/12345
Authorization: Bearer <token>
```
**Key points**:  
- IdP (client) fetches data from SP (server).  
- Communication is always **client → server**.  

---

## 🏢 Real-world scenario
A company integrates Okta (IdP) with Zoom (SP) over SCIM.  

- Okta acts as SCIM **client**, sending `POST` and `PATCH` requests.  
- Zoom acts as SCIM **server**, exposing `/Users` and `/Groups` endpoints.  
- `/ServiceProviderConfig` revealed that Zoom does **not support bulk operations**, so Okta had to issue one request per user.  

**Impact:** Smooth provisioning achieved; without architecture awareness, IT would have tried unsupported bulk calls and failed.  

---

## ❌ Common pitfalls
- Assuming SCIM works **peer-to-peer** (it is strictly client → server).  
- Forgetting to check `/ServiceProviderConfig` before using advanced features.  
- Confusing **IdP vs SP roles** (e.g., expecting the SP to initiate provisioning).  
- Not handling unsupported operations (e.g., bulk).  
- Misinterpreting **authentication scheme requirements**.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Unsupported features | Client may try PATCH/BULK not implemented | Always check `/ServiceProviderConfig` first |
| Role confusion | Misconfigured IdP/SP integration | Document client/server responsibilities |
| Over-reliance on vendor extensions | Breaks interoperability | Stick to standard schemas first |
| Network/API errors | Failed provisioning requests | Monitor logs and retry failed calls |

**Real-world:** An integration failed because the IdP assumed the SP supported bulk operations. In reality, it didn’t, leaving hundreds of users unprovisioned.  

---

## 📝 Mini quiz
1. In SCIM architecture, which component acts as the **client**?  
   a) Identity Provider (IdP)  
   b) Service Provider (SP)  
   c) Both IdP and SP  
   d) Neither, SCIM is peer-to-peer  

2. Which SCIM endpoint tells you what operations the server supports?  
   a) `/Users`  
   b) `/Groups`  
   c) `/Schemas`  
   d) `/ServiceProviderConfig`  

3. Scenario: Your IdP tries to send bulk provisioning requests, but the SP rejects them. What’s the first place you should check?  
   a) `/Schemas`  
   b) `/ServiceProviderConfig`  
   c) `/BulkConfig`  
   d) `/Extensions`  

---

## 🔗 Navigation
👉 Back: [1.01 What is SCIM?](1.01-what-is-scim.md)  
👉 Next: [1.03 Core Objects](1.03-core-objects.md)
