# ğŸ† Section 1.02 | Foundations | **"SCIM Architecture"**

## ğŸ“Œ At a glance  
SCIM follows a **clientâ€“server architecture** where an **Identity Provider (IdP)** acts as the client and a **Service Provider (SP)** exposes SCIM APIs as the server.  
This setup standardizes how identities are **provisioned, updated, and deprovisioned** across applications.  

---

## ğŸ“– What is SCIM architecture?  
SCIM architecture describes the **roles and interactions** between systems that use SCIM to exchange identity data.  

- The **IdP (Identity Provider)** â€” such as Okta, Microsoft Entra ID, or SailPoint â€” **initiates** provisioning events.  
- The **SP (Service Provider)** â€” such as Slack, Zoom, or ServiceNow â€” exposes **SCIM endpoints** (`/Users`, `/Groups`) to receive and process these requests.  
- Communication happens over **REST APIs with JSON payloads**.  

**ğŸ”„ Flow overview**
```text
Identity Provider (IdP) â”€â”€ SCIM API â”€â”€> Service Provider (SP)
    (create/update user)                 (account created/updated)
```

> **Note (worth keeping):** In SCIM, the IdP is always the **client** and the SP is always the **server**, even if both support APIs. Confusing this is a common mistake during troubleshooting.  

---

## ğŸ”‘ Key characteristics  
- **IdP as client** â†’ always initiates provisioning requests.  
- **SP as server** â†’ exposes SCIM API endpoints to process requests.  
- **Endpoints are predictable** â†’ `/Users`, `/Groups`, `/Schemas`, `/ServiceProviderConfig`.  
- **RESTful interaction** â†’ IdP sends POST/PUT/PATCH/DELETE, SP replies with JSON.  
- **Stateless operations** â†’ each request is independent, following HTTP conventions.  

---

## ğŸŒ Why it matters (and how it helps you later)  
- Knowing the architecture helps you debug **who is responsible** when something fails (IdP or SP).  
- Explains why SCIM is so widely adopted â€” it keeps roles consistent across vendors.  
- Builds the mental model youâ€™ll need before diving into **schemas** (Section 2) and **operations** (Section 3).  
- Prepares you to answer interview questions like *â€œWho initiates a SCIM request, IdP or SP?â€*.  

---

## ğŸ› ï¸ Where itâ€™s used  
- **Okta â†’ Slack**: Okta sends POST to Slack `/Users`.  
- **Entra ID â†’ ServiceNow**: Entra ID calls ServiceNow SCIM endpoints to manage accounts.  
- **SailPoint â†’ Workday**: SailPoint pushes joiner/mover/leaver events into Workday using SCIM.  

---

## ğŸ”— How this links to other concepts  
- **[What is SCIM? (1.01)](./1.01-what-is-scim.md)** â†’ introduced why SCIM exists.  
- **[User Schema (2.02)](../2-core-schema/2.02-user-schema.md)** â†’ shows what attributes flow across this architecture.  
- **[CRUD Operations (3.04)](../3-protocol-operations/3.04-crud-operations.md)** â†’ actual HTTP requests this architecture enables.  

---

<details>
<summary><strong>âš™ï¸ Technical deep dive</strong> (click to expand)</summary>

**Key SCIM endpoints defined in RFC 7644:**  

| Endpoint | Purpose |
|----------|---------|
| `/Users` | Create, update, delete, and search for user resources |
| `/Groups` | Manage group objects and memberships |
| `/Schemas` | Retrieve schema definitions for objects |
| `/ServiceProviderConfig` | Returns SCIM features supported by the SP |

**Example: IdP creating a user in SP**  
```http
POST /scim/v2/Users
{
  "userName": "jdoe",
  "name": { "givenName": "John", "familyName": "Doe" },
  "emails": [{ "value": "jdoe@example.com", "primary": true }]
}
```

**SP Response:**  
```json
{
  "id": "a123",
  "userName": "jdoe",
  "active": true
}
```
</details>

---

<details>
<summary><strong>ğŸ¢ Real-world scenario</strong> (click to expand)</summary>
An enterprise uses Okta (IdP) to manage Slack (SP).  
- When HR adds a new employee, Okta **sends a POST** to Slackâ€™s `/Users` endpoint.  
- Slack **creates the account** and returns the new user ID.  
- When the employee leaves, Okta **sends a DELETE**, and Slack **deprovisions** the account immediately.  
</details>

---

<details>
<summary><strong>âŒ Common pitfalls</strong> (click to expand)</summary>

- Misunderstanding roles (thinking SP initiates provisioning).  
- Assuming all endpoints are implemented (some SPs donâ€™t support `/Groups`).  
- Forgetting to check `/ServiceProviderConfig` to see what the SP supports.  
- Confusing IdP SCIM client logs with SP SCIM server logs during troubleshooting.  
</details>

---

<details>
<summary><strong>âš ï¸ Risks & issues</strong> (click to expand)</summary>

| Risk | Impact | Mitigation |
|------|--------|------------|
| IdP/SP role confusion | Failed troubleshooting | Always confirm which side is client/server |
| Partial endpoint support | Missing features | Check `/ServiceProviderConfig` early |
| Network/API failures | Incomplete provisioning | Monitor retries and error logs |
</details>

---

<details>
<summary><strong>ğŸ“ Mini quiz</strong> (click to expand)</summary>

1) In SCIM, who acts as the client?  
a) IdP  
b) SP  
c) Both  
d) Depends on the integration  

2) Which endpoint tells you what features the SP supports?  
a) `/Users`  
b) `/Groups`  
c) `/Schemas`  
d) `/ServiceProviderConfig`  

3) True or False: In SCIM, the SP can initiate user creation in the IdP.  
</details>

---

## ğŸ”— Navigation  
ğŸ‘‰ **Back:** [1.01 What is SCIM?](./1.01-what-is-scim.md)  
ğŸ‘‰ **Next:** [1.03 Core Objects: Users & Groups](./1.03-core-objects.md)  
