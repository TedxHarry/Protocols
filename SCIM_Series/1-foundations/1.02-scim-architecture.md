# ğŸ† Section 1.02 | Foundations | â€œSCIM Architectureâ€

---

## ğŸ“Œ At a glance
SCIM architecture describes **how identity data flows** between the Identity Provider (IdP) and Service Providers (SPs) using standardized schemas and REST APIs.  
It defines the **roles, endpoints, and communication patterns** that make SCIM work reliably across different systems.  

---

## ğŸ“– What is SCIM Architecture?
SCIM architecture provides the **structural model** for provisioning. It defines the client-server relationship:  
- The **IdP (or client)** issues SCIM requests.  
- The **SP (or server)** implements SCIM endpoints and enforces changes.  

> **Notes**
- IdP = Client, SP = Server in SCIM context.  
- Common endpoints: `/Users`, `/Groups`, `/Schemas`, `/ServiceProviderConfig`.  
- Uses REST + JSON over HTTPS for transport.  

---

## â— Problem before SCIM Architecture
- Vendors implemented **custom provisioning flows**, each with unique APIs.  
- No consistent distinction between **identity source (client)** and **application (server)**.  
- Hard to standardize joiner/mover/leaver flows.  
- Resulted in brittle, one-off integrations that were difficult to maintain.  

---

## ğŸ”‘ Key characteristics
- **Client-Server Model** â†’ IdP acts as client; SP exposes SCIM server endpoints.  
- **Resource-Oriented** â†’ Every identity object (User/Group) is a resource with CRUD operations.  
- **Discoverable** â†’ `/ServiceProviderConfig` tells what features the SP supports.  
- **Schema-driven** â†’ Resources validated against SCIM schema definitions.  
- **Transport** â†’ HTTPS + REST + JSON for simple, secure communication.  
- **Extensible** â†’ Enterprises can add custom schemas without breaking compatibility.  

---

## ğŸŒ Why it matters (and how it helps you later)
- SCIM architecture helps you visualize **how provisioning works end-to-end**.  
- Clarifies the **roles** of IdP vs SP â†’ a must-know before learning protocol operations.  
- Ensures you understand where **schemas** and **endpoints** fit in.  
- Career-wise, it prepares you to design or troubleshoot **real SCIM integrations** between HR â†’ IdP â†’ App.  

---

## ğŸ› ï¸ Where itâ€™s used (flows + impact)

### ASCII Flow
```
[HR System] â†’ [IdP / SCIM Client] â†’ [SCIM Server / App]
      Hire â†’      POST /Users     â†’   Creates new account
    Transfer â†’     PATCH /Users   â†’   Updates attributes
 Termination â†’ DELETE or PATCH    â†’   Deactivates account
```

- **Joiner**: IdP â†’ `POST /Users` â†’ new account in SP.  
- **Mover**: IdP â†’ `PATCH /Users` â†’ updates department/role.  
- **Leaver**: IdP â†’ `PATCH active:false` â†’ disables account.  

**With SCIM Architecture:**  
- Communication roles are **standardized**.  
- IdP doesnâ€™t need to learn SP internals â€” just speak SCIM.  
- Apps advertise capabilities via `/ServiceProviderConfig`.  

---

## ğŸ”— How this links to other concepts
- [1.01 What is SCIM?](1.01-what-is-scim.md) â†’ Introduced SCIM as a protocol; now you see **how roles and endpoints interact**.  
- [1.03 Core Objects](1.03-core-objects.md) â†’ Next, we dive into **Users and Groups**, the objects SCIM architecture manages.  
- [3.02 Endpoints](../3-protocol-operations/3.02-endpoints.md) â†’ Later, youâ€™ll explore **every endpoint in detail**, starting from this architectural view.  

---

## âš™ï¸ Technical deep dive

### Example: Discover SCIM server capabilities
```http
GET /ServiceProviderConfig
Content-Type: application/scim+json
```
**Response Example:**
```json
{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:ServiceProviderConfig"],
  "patch": { "supported": true },
  "bulk": { "supported": false },
  "filter": { "supported": true, "maxResults": 200 },
  "authenticationSchemes": [
    { "type": "oauthbearertoken", "name": "OAuth Bearer Token" }
  ]
}
```
**Key points**:  
- Tells whether **PATCH, bulk, filtering** are supported.  
- Lists supported **authentication schemes**.  

### Example: Basic User fetch
```http
GET /Users/12345
Authorization: Bearer <token>
```
**Key points**:  
- IdP (client) fetches data from SP (server).  
- Communication is always **client â†’ server**.  

---

## ğŸ¢ Real-world scenario
A company integrates Okta (IdP) with Zoom (SP) over SCIM.  

- Okta acts as SCIM **client**, sending `POST` and `PATCH` requests.  
- Zoom acts as SCIM **server**, exposing `/Users` and `/Groups` endpoints.  
- `/ServiceProviderConfig` revealed that Zoom does **not support bulk operations**, so Okta had to issue one request per user.  

**Impact:** Smooth provisioning achieved; without architecture awareness, IT would have tried unsupported bulk calls and failed.  

---

## âŒ Common pitfalls
- Assuming SCIM works **peer-to-peer** (it is strictly client â†’ server).  
- Forgetting to check `/ServiceProviderConfig` before using advanced features.  
- Confusing **IdP vs SP roles** (e.g., expecting the SP to initiate provisioning).  
- Not handling unsupported operations (e.g., bulk).  
- Misinterpreting **authentication scheme requirements**.  

---

## âš ï¸ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Unsupported features | Client may try PATCH/BULK not implemented | Always check `/ServiceProviderConfig` first |
| Role confusion | Misconfigured IdP/SP integration | Document client/server responsibilities |
| Over-reliance on vendor extensions | Breaks interoperability | Stick to standard schemas first |
| Network/API errors | Failed provisioning requests | Monitor logs and retry failed calls |

**Real-world:** An integration failed because the IdP assumed the SP supported bulk operations. In reality, it didnâ€™t, leaving hundreds of users unprovisioned.  

---

## ğŸ“ Mini quiz
1. In SCIM architecture, which component acts as the **client**?  
   a) Identity Provider (IdP)  
   b) Service Provider (SP)  
   c) Both IdP and SP  
   d) Neither, SCIM is peer-to-peer  

2. Which SCIM endpoint tells you what operations the server supports?  
   a) `/Users`  
   b) `/Groups`  
   c) `/Schemas`  
   d) `/ServiceProviderConfig`  

3. Scenario: Your IdP tries to send bulk provisioning requests, but the SP rejects them. Whatâ€™s the first place you should check?  
   a) `/Schemas`  
   b) `/ServiceProviderConfig`  
   c) `/BulkConfig`  
   d) `/Extensions`  

---

## ğŸ”— Navigation
ğŸ‘‰ Back: [1.01 What is SCIM?](1.01-what-is-scim.md)  
ğŸ‘‰ Next: [1.03 Core Objects](1.03-core-objects.md)
