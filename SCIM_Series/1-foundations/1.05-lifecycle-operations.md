# 🏆 Section 1.05 | Foundations | “Lifecycle Operations”

---

## 📌 At a glance
Lifecycle operations in SCIM map to the **joiner, mover, and leaver** stages of an identity’s journey.  
They define how accounts are **created, updated, and deactivated** automatically across applications.  

---

## 📖 What are Lifecycle Operations?
Lifecycle operations are the **core provisioning flows** standardized by SCIM:  
- **Joiner** → Create account when someone is hired or added.  
- **Mover** → Update account when someone changes roles, departments, or groups.  
- **Leaver** → Disable or delete account when someone leaves.  

> **Notes**
- Defined in **RFC 7644 (SCIM Protocol)**.  
- Implemented using **POST, PUT, PATCH, DELETE**.  
- Central to IAM because they enforce the principle of **least privilege**.  

---

## ❗ Problem before SCIM Lifecycle
- Provisioning was **manual** and ticket-driven.  
- Employees waited days or weeks for access.  
- Movers often retained **old permissions**, leading to toxic access.  
- Leavers were left with active accounts, causing audit failures.  

---

## 🔑 Key characteristics
- **Automated provisioning** → Joiners receive accounts instantly.  
- **Dynamic updates** → Movers automatically inherit correct access.  
- **Clean deprovisioning** → Leavers lose access without delay.  
- **Standard operations** → Same verbs across apps (`POST`, `PATCH`, `DELETE`).  
- **Audit visibility** → Every operation leaves a trace for compliance.  
- **Extensible** → Can add enterprise extensions for HR attributes.  

---

## 🌍 Why it matters (and how it helps you later)
- Lifecycle operations are the **heart of IAM automation**.  
- They directly map HR events → IT provisioning.  
- Mastering lifecycle flows prepares you for **advanced orchestration in IGA and CIAM**.  
- Real-world IAM projects succeed or fail based on **how well lifecycle operations are automated**.  

---

## 🛠️ Where it’s used (flows + impact)

### ASCII Flow: End-to-End
```
[HR Hire] → [IdP] → SCIM POST /Users → [App Account Created]
[Role Change] → [IdP] → SCIM PATCH /Users → [App Attributes Updated]
[Termination] → [IdP] → SCIM PATCH active:false → [App Account Disabled]
```

Impact:  
- ❌ Before SCIM → Manual processes, privilege creep, orphaned accounts.  
- ✅ With SCIM → Automated, real-time provisioning, compliant access control.  

---

## 🔗 How this links to other concepts
- [1.04 SCIM vs LDAP](1.04-scim-vs-ldap.md) → LDAP never handled SaaS lifecycle flows well; SCIM was built for it.  
- [3.04 CRUD Operations](../3-protocol-operations/3.04-crud-operations.md) → Details the HTTP methods that implement these lifecycle events.  
- [5.03 Troubleshooting](../5-real-world-implementation/5.03-troubleshooting.md) → Shows what happens when lifecycle flows break in production.  

---

## ⚙️ Technical deep dive

### Example: Joiner (Create User)
```http
POST /Users
Content-Type: application/scim+json

{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "alex.lee",
  "name": { "givenName": "Alex", "familyName": "Lee" },
  "emails": [{ "value": "alex.lee@example.com", "primary": true }]
}
```

### Example: Mover (Update Department)
```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "department",
    "value": "Engineering"
  }]
}
```

### Example: Leaver (Disable User)
```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "active",
    "value": false
  }]
}
```

---

## 🏢 Real-world scenario
A financial services company automates HR-driven provisioning.  

- Before SCIM: IT received ~500 joiner/mover/leaver tickets per month. Processing times averaged 3–7 days. Audit found 10% of leavers still had app access.  
- With SCIM: Workday → IdP → SCIM → 40 SaaS apps. Processing time dropped to **<30 minutes**, with full audit logs.  

**Impact:** Compliance scores improved, and IT workload dropped by 80%.  

---

## ❌ Common pitfalls
- Using `DELETE` instead of `active:false` for leavers → breaks audit trails.  
- Forgetting to update group memberships during **mover** flows.  
- Assuming all vendors fully support PATCH → some only support PUT.  
- Not monitoring for provisioning failures (silent errors leave accounts active).  
- Overlooking dependency on HR system accuracy.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Silent provisioning errors | Accounts not created/disabled | Monitor SCIM logs and retry failures |
| Vendor PATCH limitations | Updates fail unexpectedly | Check `/ServiceProviderConfig` for supported methods |
| Incorrect mover logic | Privilege creep from old entitlements | Automate group/role cleanups |
| DELETE used instead of disable | Lost audit evidence | Standardize on `active:false` |

**Real-world:** A bank failed audit after 300 contractors retained SaaS access because leaver events weren’t monitored.  

---

## 📝 Mini quiz
1. Which SCIM operation corresponds to a **joiner event**?  
   a) PATCH  
   b) POST  
   c) DELETE  
   d) GET  

2. Which attribute should be used to disable a leaver without deleting?  
   a) `status`  
   b) `enabled`  
   c) `active`  
   d) `terminated`  

3. Scenario: An employee changes departments, but their old entitlements remain. Which lifecycle stage was not handled properly?  
   a) Joiner  
   b) Mover  
   c) Leaver  
   d) None, SCIM doesn’t cover this  

---

## 🔗 Navigation
👉 Back: [1.04 SCIM vs LDAP](1.04-scim-vs-ldap.md)  
👉 Next: [1.06 SCIM in IAM](1.06-scim-in-iam.md)
