# 🏆 Section 3.03 | Protocol Operations | “HTTP Methods”

---

## 📌 At a glance
SCIM relies on standard **HTTP methods** to perform lifecycle operations on identity resources.  
These verbs map directly to **create, read, update, and delete (CRUD)** actions.  

---

## 📖 What are SCIM HTTP Methods?
HTTP methods define the **type of operation** performed on a SCIM endpoint.  
They ensure that provisioning actions are predictable and consistent across systems.  

> **Notes**
- Defined in **RFC 7644 (SCIM Protocol)**.  
- Core methods: GET, POST, PUT, PATCH, DELETE.  
- Each method has specific semantics and constraints in SCIM.  

---

## 🔑 Key characteristics
- **GET** → Retrieves resources (users, groups).  
- **POST** → Creates new resources.  
- **PUT** → Replaces an existing resource.  
- **PATCH** → Partially updates resource attributes.  
- **DELETE** → Removes or deactivates a resource.  
- Methods follow **idempotency rules**: PUT is idempotent, PATCH is not.  

---

## 🌍 Why it matters (and how it helps you later)
- Every SCIM lifecycle event (joiner, mover, leaver) maps to these methods.  
- Misusing verbs can cause serious issues: e.g., using DELETE instead of PATCH removes audit evidence.  
- As an IAM engineer, knowing **which method to use and when** helps ensure integrations are secure and compliant.  

---

## 🛠️ Where it’s used (flows + impact)

### Example Mapping
```
HR → IdP → SCIM Methods → SaaS App
```

- Joiner → `POST /Users` → New account created.  
- Mover → `PATCH /Users` → Department or role updated.  
- Leaver → `PATCH active:false` → Account disabled.  
- Hard delete (rare) → `DELETE /Users/{id}`.  

Impact: Correct method choice prevents **provisioning errors and audit failures**.  

---

## 🔗 How this links to other concepts
- [3.02 Endpoints](3.02-endpoints.md) → Methods act on endpoints like `/Users` and `/Groups`.  
- [3.04 CRUD Operations](3.04-crud-operations.md) → Deep dive into how methods implement lifecycle events.  
- [4.02 Error Codes](../4-security-error-handling/4.02-error-codes.md) → Errors are tied to misuse or failure of HTTP methods.  

---

## ⚙️ Technical deep dive

### Example: POST (Create User)
```http
POST /Users
Content-Type: application/scim+json

{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "jdoe",
  "emails": [{ "value": "jdoe@example.com", "primary": true }]
}
```

### Example: PATCH (Update User Department)
```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "department",
    "value": "Finance"
  }]
}
```

### Example: DELETE (Deactivate User)
```http
DELETE /Users/2819c223-7f76-453a-919d-413861904646
```

**Key points**:  
- Use `PATCH active:false` instead of `DELETE` for compliance.  
- PUT replaces the entire resource, which can wipe out fields if not included.  
- GET should support filters for efficient queries.  

---

## 🏢 Real-world scenario
A financial services firm integrated Okta with ServiceNow via SCIM.  

- Initially used `DELETE /Users` for leavers → lost audit trail.  
- Switched to `PATCH active:false` → accounts disabled while preserving history.  

**Impact:** Passed compliance audit and avoided ghost accounts.  

---

## ❌ Common pitfalls
- Misusing `DELETE` instead of disabling → compliance failure.  
- Assuming PATCH is always supported → some vendors only allow PUT.  
- Forgetting idempotency rules (PUT can be retried safely; PATCH cannot).  
- Not handling multi-valued attributes correctly in PATCH.  
- Overwriting entire user objects accidentally with PUT.  

---

## ⚠️ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| Wrong method choice | Lost data, failed compliance | Follow SCIM method standards |
| Vendor PATCH limitations | Updates rejected | Check `/ServiceProviderConfig` |
| PUT misuse | Attributes wiped out | Use PATCH unless full replace needed |
| DELETE misuse | Lost audit evidence | Use PATCH active:false for deprovisioning |

**Real-world:** An IAM team accidentally wiped out thousands of user phone numbers by sending a PUT request without those fields. PATCH would have preserved them.  

---

## 📝 Mini quiz
1. Which HTTP method is **idempotent** in SCIM?  
   a) PATCH  
   b) PUT  
   c) POST  
   d) DELETE  

2. Which method is best practice for disabling a user (leaver event)?  
   a) DELETE  
   b) PUT  
   c) PATCH with `active:false`  
   d) GET  

3. Scenario: An integration fails because PATCH is unsupported by the SaaS app. What should you use instead?  
   a) PUT  
   b) POST  
   c) DELETE  
   d) GET  

---

## 🔗 Navigation
👉 Back: [3.02 Endpoints](3.02-endpoints.md)  
👉 Next: [3.04 CRUD Operations](3.04-crud-operations.md)  

➡️ Next, we’ll explore **CRUD Operations (3.04)** to see how lifecycle events are executed with these HTTP methods in detail.
