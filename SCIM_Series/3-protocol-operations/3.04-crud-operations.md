# ğŸ† Section 3.04 | Protocol Operations | â€œCRUD Operationsâ€

---

## ğŸ“Œ At a glance
CRUD (Create, Read, Update, Delete) operations in SCIM map directly to **HTTP methods**.  
They are the building blocks of SCIM provisioning flows for users and groups.  

---

## ğŸ“– What are CRUD Operations in SCIM?
CRUD operations define how clients (IdPs) manage resources (Users, Groups) on SCIM servers (SaaS apps).  
They ensure consistent provisioning behavior across all compliant systems.  

> **Notes**
- Defined in **RFC 7644**.  
- CRUD = Create (POST), Read (GET), Update (PUT/PATCH), Delete (DELETE).  
- Foundation for lifecycle events: joiner, mover, leaver.  

---

## â— Problem before SCIM CRUD
- Every vendor used proprietary APIs with inconsistent verbs.  
- Example: One app used SOAP, another used CSV upload, another used custom REST.  
- This led to **connector sprawl**, high cost, and brittle integrations.  
- SCIM CRUD standardized these operations â†’ one model, many apps.  

---

## ğŸ”‘ Key characteristics
- **Create** â†’ `POST /Users` or `POST /Groups`.  
- **Read** â†’ `GET /Users/{id}` or `GET /Groups/{id}`.  
- **Update** â†’ `PUT` (full replace) or `PATCH` (partial update).  
- **Delete** â†’ `DELETE /Users/{id}` (or better â†’ `PATCH active:false`).  
- **Idempotency** â†’ PUT can be retried safely, PATCH cannot.  
- **Filtering support** â†’ `GET /Users?filter=userName eq "jsmith"`.  

---

## ğŸŒ Why it matters (and how it helps you later)
- CRUD operations are the **core mechanics** of provisioning.  
- Every joiner/mover/leaver event in IAM maps back to CRUD.  
- As an IAM engineer, youâ€™ll troubleshoot CRUD flows daily.  
- Understanding CRUD also prepares you for advanced features like **bulk operations and filtering**.  

---

## ğŸ› ï¸ Where itâ€™s used (flows + impact)

### Joiner â†’ Create
```
HR â†’ IdP â†’ POST /Users â†’ App Account Created
```

### Mover â†’ Update
```
Role Change â†’ IdP â†’ PATCH /Users â†’ App Attributes Updated
```

### Leaver â†’ Deactivate
```
Termination â†’ IdP â†’ PATCH active:false â†’ App Account Disabled
```

Impact: CRUD ensures **consistency across vendors**, reducing integration costs.  

---

## ğŸ”— How this links to other concepts
- [3.03 HTTP Methods](3.03-http-methods.md) â†’ CRUD is the structured use of those verbs.  
- [3.05 Filtering](3.05-filtering.md) â†’ Enhances Read by narrowing results.  
- [3.08 Bulk Operations](3.08-bulk-operations.md) â†’ Optimizes multiple CRUD actions at once.  

---

## âš™ï¸ Technical deep dive

### Example: Create user
```http
POST /Users
Content-Type: application/scim+json

{
  "schemas": ["urn:ietf:params:scim:schemas:core:2.0:User"],
  "userName": "ajones",
  "emails": [{ "value": "ajones@example.com", "primary": true }]
}
```

### Example: Read user by ID
```http
GET /Users/2819c223-7f76-453a-919d-413861904646
Authorization: Bearer <token>
```

### Example: Update user (PATCH)
```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "department",
    "value": "Finance"
  }]
}
```

### Example: Delete user
```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas":["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [{
    "op": "replace",
    "path": "active",
    "value": false
  }]
}
```

**Key points**:  
- `DELETE` can remove records, but `PATCH active:false` is safer.  
- CRUD examples must always respect the SCIM schema.  
- Audit-friendly flows prefer disabling over hard deletes.  

---

## ğŸ¢ Real-world scenario
A company provisions ServiceNow accounts from Workday.  

- Joiners â†’ `POST /Users` â†’ instant ServiceNow accounts.  
- Movers â†’ `PATCH /Users` â†’ updated department and roles.  
- Leavers â†’ `PATCH active:false` â†’ account disabled, audit trail intact.  

**Impact:** Reduced onboarding from 3 days â†’ under 30 minutes, eliminated ghost accounts.  

---

## âŒ Common pitfalls
- Using PUT for partial updates â†’ wipes attributes not included.  
- Relying on DELETE â†’ loses audit history.  
- Not implementing GET filters â†’ leads to performance issues on large datasets.  
- Assuming PATCH supported everywhere.  
- Forgetting idempotency rules â†’ leads to inconsistent updates.  

---

## âš ï¸ Risks & issues

| Risk | Impact | Mitigation |
|------|--------|------------|
| PUT misuse | Overwrites attributes unintentionally | Use PATCH unless full replace needed |
| DELETE misuse | Breaks audit trails | Use PATCH active:false instead |
| Missing filter logic | Large data transfers | Implement filtering in syncs |
| Vendor gaps in PATCH | Updates fail | Check `/ServiceProviderConfig` before deploying |

**Real-world:** A provisioning job accidentally cleared thousands of email addresses because PUT was used instead of PATCH.  

---

## ğŸ“ Mini quiz
1. Which HTTP method is recommended for disabling a user?  
   a) DELETE  
   b) PATCH with `active:false`  
   c) PUT  
   d) GET  

2. Which CRUD action corresponds to `GET /Groups`?  
   a) Create  
   b) Read  
   c) Update  
   d) Delete  

3. Scenario: A sync job sends PUT instead of PATCH, wiping out user phone numbers. Whatâ€™s the error?  
   a) Wrong filter applied  
   b) Misuse of idempotent method  
   c) PUT used instead of PATCH  
   d) UserName missing  

---

## ğŸ”— Navigation
ğŸ‘‰ Back: [3.03 HTTP Methods](3.03-http-methods.md)  
ğŸ‘‰ Next: [3.05 Filtering](3.05-filtering.md)  

â¡ï¸ Next, weâ€™ll explore **Filtering (3.05)** to see how SCIM enables powerful search and query capabilities.
