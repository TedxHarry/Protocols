![Cover](./covers/2.11-deprovisioning.png)
# ğŸ† Section 2.11 | SCIM in Practice | â€œDeprovisioning & Lifecycle Management in Practiceâ€

Provisioning gets the spotlight, but **deprovisioning** is just as critical.  
When employees leave, contractors finish projects, or accounts are no longer needed, you must **remove access quickly and safely**.  

---

## ğŸ“– Why Deprovisioning Matters  

- **Security** â†’ prevent orphan accounts that can be exploited.  
- **Compliance** â†’ ensure ex-employees donâ€™t retain access.  
- **Cost Control** â†’ free up licenses from unused accounts.  
- **Auditability** â†’ leave behind a clear trail of access changes.  

---

## 1ï¸âƒ£ SCIM Deprovisioning Options  

There are two common approaches:  

### `PATCH` â†’ `active:false` (Preferred)  
- Keeps the resource for audit and references.  
- Disables login without deleting the record.  
- Most enterprise-friendly option.  

```http
PATCH /Users/2819c223-7f76-453a-919d-413861904646
Content-Type: application/scim+json

{
  "schemas": ["urn:ietf:params:scim:api:messages:2.0:PatchOp"],
  "Operations": [
    { "op": "replace", "path": "active", "value": false }
  ]
}
```

### `DELETE` (Rare)  
- Permanently removes the user.  
- Breaks references (e.g., groups, audit history).  
- Some SaaS apps still expect this.  

```http
DELETE /Users/2819c223-7f76-453a-919d-413861904646
```

âš ï¸ Avoid DELETE unless the vendor explicitly requires it.  

---

## 2ï¸âƒ£ Lifecycle Management States  

SCIM itself only defines `active`, but enterprises often extend lifecycle concepts:  

- **Active** â†’ account is usable.  
- **Suspended** â†’ account is temporarily disabled (e.g., leave of absence).  
- **Deprovisioned** â†’ account is permanently inactive.  
- **Deleted** â†’ account is fully removed (risky for audit).  

ğŸ’¡ You may need to **map HR lifecycle events** (hire, suspend, terminate, rehire) into SCIM operations.  

---

## 3ï¸âƒ£ Hands-On Lab: Try It Yourself  

### Setup in Postman  
1. Create a request â†’ `PATCH /Users/{id}`.  
2. Add header â†’ `Content-Type: application/scim+json`.  
3. Paste the `active:false` JSON example.  
4. Send the request.  

### Expected Response  

```json
{
  "id": "2819c223-7f76-453a-919d-413861904646",
  "userName": "jane.doe",
  "active": false,
  "meta": { "lastModified": "2025-10-13T15:04:05Z" }
}
```

### Bonus: Test Delete  
1. Send `DELETE /Users/{id}`.  
2. Expected: `204 No Content`.  
3. Try fetching the user again â†’ should return `404 Not Found`.  

---

## âš ï¸ Common Pitfalls (and Impact)  

- âŒ **Using DELETE instead of PATCH** â†’ lose audit history.  
- âŒ **Not deactivating promptly** â†’ leaves security gaps.  
- âŒ **Vendors ignoring `active:false`** â†’ some SPs donâ€™t respect it.  
- âŒ **Forgetting group cleanup** â†’ deactivated users may still show as group members.  
- âŒ **Poor HR integration** â†’ lifecycle events not mapped â†’ users stay active.  

---

## âœ… Best Practices  

- Use `active:false` for safe deprovisioning.  
- Reserve `DELETE` for cases where the vendor explicitly requires it.  
- Always log lifecycle changes for audit.  
- Align SCIM deprovisioning with **HR system events**.  
- Verify downstream apps actually block access after deactivation.  

---

## ğŸ¢ Real-World Scenarios  

- **Employee Termination** â†’ `PATCH active:false` on last working day.  
- **Leave of Absence** â†’ temporarily deactivate (or suspend if supported).  
- **Contractor Offboarding** â†’ bulk deprovision multiple users.  
- **Rehire** â†’ set `active:true` again instead of creating a new account.  

---

## ğŸ“ Self-Check  

1ï¸âƒ£ Why is PATCH with `active:false` preferred over DELETE?  
2ï¸âƒ£ What lifecycle states might you implement beyond SCIMâ€™s `active`?  
3ï¸âƒ£ Whatâ€™s the risk of vendors ignoring the `active` attribute?  
4ï¸âƒ£ How should HR events map into SCIM lifecycle operations?  

---

## ğŸ¯ Final Takeaway  

Deprovisioning is the most important security step in SCIM.  
- Always prefer `active:false` to preserve audit history.  
- DELETE only when unavoidable.  
- Map lifecycle states to HR events.  
- Confirm downstream apps respect deprovisioning.  

ğŸ’¡ Proper deprovisioning closes security gaps, keeps compliance intact, and ensures licenses are used efficiently.  

---

## ğŸ”— Navigation  

ğŸ‘‰ Back: [2.10 Bulk Operations](2.10-bulk-operations.md)  
ğŸ‘‰ Next: [2.12 SCIM Error Model (and Why It Matters)](2.12-error-model.md)  
