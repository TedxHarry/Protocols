# 5.2.2 Create, Update, Delete Operations

**Learning Objective:** Understand the three core provisioning operations and how they work.

---

## Provisioning Operations Overview

### **Three Core Operations**

| Operation | Purpose | When Used | Example |
|-----------|---------|-----------|---------|
| **Create** | Make new account | New hire, new access | Create AD account for new employee |
| **Update** | Modify existing account | Attribute changes, group adds | Update department, add to group |
| **Delete** | Remove account | Termination, access removal | Delete AD account after retention |

**Additional operations:**
- **Enable**: Activate disabled account
- **Disable**: Deactivate account (soft delete)

**Exam Tip:** Create makes new accounts, Update modifies existing accounts, Delete removes accounts. Most sources support all three.

---

## Create Operation

### **What is Create?**

**Definition:** Provisioning operation that creates a new account in the target system

**When Create occurs:**
```
Triggers:
  - New hire (lifecycle: prehire → active)
  - Access request approved (new access)
  - Role assigned (requires new account)
  - Manual admin creates account
```

### **Create Process**

**Step-by-step:**
```
1. ISC determines account needed
   Example: Employee needs AD account

2. ISC gathers required attributes
   Collects:
     - Username (uid)
     - First name, last name
     - Email
     - Department
     - Initial groups

3. ISC applies provisioning policy
   Maps ISC attributes to target attributes:
     ISC: firstName → AD: givenName
     ISC: lastName → AD: sn
     ISC: email → AD: mail

4. ISC sends create command
   Via VA (on-prem) or direct API (cloud)

5. Target system creates account
   AD: New-ADUser executed
   Account created

6. Target system responds
   Success: Account created
   Failure: Error message

7. ISC records result
   Success: Account linked to identity
   Failure: Retry or alert admin
```

### **Create Example - Active Directory**

**Scenario: Create AD account for new employee**
```
Identity: John Smith
  uid: john.smith
  firstName: John
  lastName: Smith
  email: john.smith@company.com
  department: Sales
  employeeNumber: EMP12345
  manager: Jane Doe

ISC Create Operation:

1. Gather Attributes:
   sAMAccountName: john.smith
   givenName: John
   sn: Smith
   displayName: John Smith
   mail: john.smith@company.com
   department: Sales
   employeeID: EMP12345
   manager: CN=Jane Doe,OU=Users,DC=company,DC=com

2. Generate Password:
   Password: Random 16-character
   mustChangePassword: True

3. Determine OU:
   Based on department:
     Sales → OU=Sales,OU=Users,DC=company,DC=com

4. Assign Groups:
   Default groups:
     - Domain Users (automatic)
     - All-Employees
     - VPN-Users
   Department groups:
     - Sales-Team

5. Send Command to VA:
   Operation: Create
   Source: Active Directory
   Attributes: [above]
   OU: OU=Sales,OU=Users,DC=company,DC=com
   Groups: [above]

6. VA Executes PowerShell:
   New-ADUser -Name "john.smith" `
     -GivenName "John" `
     -Surname "Smith" `
     -DisplayName "John Smith" `
     -SamAccountName "john.smith" `
     -UserPrincipalName "john.smith@company.com" `
     -EmailAddress "john.smith@company.com" `
     -Department "Sales" `
     -EmployeeID "EMP12345" `
     -Manager "CN=Jane Doe,OU=Users,DC=company,DC=com" `
     -Path "OU=Sales,OU=Users,DC=company,DC=com" `
     -AccountPassword (ConvertTo-SecureString "P@ssw0rd123!" -AsPlainText -Force) `
     -ChangePasswordAtLogon $true `
     -Enabled $true

   Add-ADGroupMember -Identity "All-Employees" -Members "john.smith"
   Add-ADGroupMember -Identity "VPN-Users" -Members "john.smith"
   Add-ADGroupMember -Identity "Sales-Team" -Members "john.smith"

7. VA Reports Success:
   Account Created: john.smith
   Groups Added: All-Employees, VPN-Users, Sales-Team
   Status: Success

8. ISC Updates Records:
   Identity: John Smith
     Accounts:
       - Active Directory: john.smith (NEW)
   
   Provisioning Log:
     Operation: Create
     Source: Active Directory
     Account: john.smith
     Status: Success
     Timestamp: 2024-02-14 10:30:15
```

---

### **Create Example - Salesforce**

**Scenario: Create Salesforce account**
```
Identity: John Smith
  email: john.smith@company.com
  firstName: John
  lastName: Smith
  department: Sales

ISC Create Operation:

1. Gather Attributes:
   Username: john.smith@company.com
   Email: john.smith@company.com
   FirstName: John
   LastName: Smith
   Department: Sales
   ProfileId: Standard User (looked up)
   UserRoleId: Sales Rep (based on department)

2. Assign License:
   License: Sales Cloud

3. Send API Call:
   POST /services/data/v58.0/sobjects/User
   
   Body:
   {
     "Username": "john.smith@company.com",
     "Email": "john.smith@company.com",
     "FirstName": "John",
     "LastName": "Smith",
     "Department": "Sales",
     "ProfileId": "00exx000001abcd",
     "UserRoleId": "00Exx000000efgh",
     "Alias": "jsmith",
     "TimeZoneSidKey": "America/New_York",
     "LocaleSidKey": "en_US",
     "EmailEncodingKey": "UTF-8",
     "LanguageLocaleKey": "en_US"
   }

4. Salesforce Creates User:
   User Created
   User ID: 005xx000001234AAA

5. Salesforce Responds:
   {
     "id": "005xx000001234AAA",
     "success": true
   }

6. ISC Records:
   Identity: John Smith
     Accounts:
       - Salesforce: john.smith@company.com (NEW)
   
   Salesforce Account ID: 005xx000001234AAA
```

---

## Update Operation

### **What is Update?**

**Definition:** Provisioning operation that modifies an existing account

**When Update occurs:**
```
Triggers:
  - Attribute changes (department, title, manager)
  - Group membership changes (add/remove groups)
  - Role changes
  - Access profile changes
  - Manual admin updates
```

### **Update Process**

**Step-by-step:**
```
1. ISC detects change needed
   Example: Employee transferred to new department

2. ISC identifies account to update
   Find existing account in target system

3. ISC determines what to change
   Compare current vs. desired state

4. ISC sends update command
   Only changed attributes sent (delta)

5. Target system updates account
   Modifies specified attributes/groups

6. Target system responds
   Success or failure

7. ISC records update
   Log what changed
```

### **Update Types**

**Type 1: Attribute Update**
```
Scenario: Employee department changes

Before:
  department: IT

After:
  department: Sales

Update Operation:
  ISC sends: Set department = "Sales"
  AD updates: Department attribute changed
  Result: department now shows "Sales"
```

**Type 2: Group Membership Update (Add)**
```
Scenario: Employee needs VPN access

Operation: Add to group

ISC sends:
  Add john.smith to VPN-Users group

AD executes:
  Add-ADGroupMember -Identity "VPN-Users" -Members "john.smith"

Result:
  john.smith now member of VPN-Users
  User can access VPN
```

**Type 3: Group Membership Update (Remove)**
```
Scenario: Employee no longer needs sales tools

Operation: Remove from group

ISC sends:
  Remove john.smith from Sales-Tools group

AD executes:
  Remove-ADGroupMember -Identity "Sales-Tools" -Members "john.smith"

Result:
  john.smith no longer member
  Access to sales tools revoked
```

**Type 4: Multi-Attribute Update**
```
Scenario: Employee promoted

Changes:
  title: "Developer" → "Senior Developer"
  department: "IT" → "Engineering"
  manager: "Bob Wilson" → "Jane Doe"

Update Operation:
  ISC sends:
    Set title = "Senior Developer"
    Set department = "Engineering"
    Set manager = "CN=Jane Doe,OU=Users,DC=company,DC=com"

AD updates all three attributes in single operation

Result: All attributes updated
```

---

### **Update Example - Department Transfer**

**Scenario: Employee moves IT → Sales**
```
Employee: John Smith
Current:
  department: IT
  Member of: IT-All, IT-Dev-Team
  
New:
  department: Sales
  Should be member of: Sales-Team, Sales-Tools

ISC Update Operation:

1. Attribute Update:
   Change department: IT → Sales
   
   Command:
     Set-ADUser -Identity "john.smith" -Department "Sales"

2. Remove Old Groups:
   Remove from IT groups
   
   Commands:
     Remove-ADGroupMember -Identity "IT-All" -Members "john.smith"
     Remove-ADGroupMember -Identity "IT-Dev-Team" -Members "john.smith"

3. Add New Groups:
   Add to Sales groups
   
   Commands:
     Add-ADGroupMember -Identity "Sales-Team" -Members "john.smith"
     Add-ADGroupMember -Identity "Sales-Tools" -Members "john.smith"

4. Result:
   department: Sales ✓
   Groups:
     ✓ Sales-Team (new)
     ✓ Sales-Tools (new)
     ✗ IT-All (removed)
     ✗ IT-Dev-Team (removed)

5. ISC Logs:
   Operation: Update
   Account: john.smith
   Changes:
     - department: IT → Sales
     - Groups removed: IT-All, IT-Dev-Team
     - Groups added: Sales-Team, Sales-Tools
   Status: Success
```

---

## Delete Operation

### **What is Delete?**

**Definition:** Provisioning operation that removes an account from the target system

**When Delete occurs:**
```
Triggers:
  - Termination (after retention period)
  - Access removal (revoke access)
  - Cleanup of old accounts
  - Compliance deletion requirements
```

### **Delete vs. Disable**

**Critical difference:**

| Aspect | Disable | Delete |
|--------|---------|--------|
| **Account** | Exists, inactive | Removed completely |
| **Data** | Preserved | Lost |
| **Reversible** | Yes (re-enable) | No (must recreate) |
| **When** | Immediate (Day 0) | After retention (Day 90) |
| **Security** | Access blocked | Access blocked |

**Recommended approach:**
```
Day 0 (Termination):
  ✓ Disable account (immediate)
  
Day 30-90 (Retention complete):
  ✓ Delete account (cleanup)
```

---

### **Delete Process**

**Step-by-step:**
```
1. ISC determines delete needed
   Example: Account disabled for 90 days, retention complete

2. ISC verifies delete conditions
   Checks:
     - Retention period complete?
     - No legal holds?
     - No active tickets?

3. ISC sends delete command
   Operation: Delete account

4. Target system deletes account
   Account removed permanently

5. Target system responds
   Success: Account deleted
   Failure: Error (e.g., account has dependencies)

6. ISC records deletion
   Log deletion event
   Remove account link from identity
   Preserve audit trail
```

---

### **Delete Example - Active Directory**

**Scenario: Delete account after 90-day retention**
Account: john.smith
Status: Disabled for 94 days
Termination Date: Feb 14, 2024
Current Date: May 19, 2024
Legal Holds: None
Retention Policy: 90 days
ISC Delete Operation:

Verify Conditions:
✓ Disabled for 94 days (>90 required)
✓ No legal holds
✓ No active tickets
✓ Retention period complete
Send Delete Command to VA:
Operation: Delete
Account: john.smith
Source: Active Directory
VA Executes PowerShell:
Remove-ADUser -Identity "john.smith" -Confirm:$false
AD Deletes Account:
Account: john.smith
Status: Deleted (moved to Deleted Objects for tombstone period)
All data: Removed
Group memberships: Removed
Cannot be recovered (except from backup)
VA Reports Success:
Account Deleted: john.smith
Status: Success
ISC Updates Records:
Identity: John Smith
cloudLifecycleState: inactive
Accounts:
- Active Directory: (removed from list)
Deletion Log:
Operation: Delete
Account: john.smith
Source: Active Directory
Reason: Retention period complete (90 days)
Deleted By: Automated cleanup job
Timestamp: 2024-05-19 03:15:22
Audit Trail Preserved:

Identity record kept (inactive)
Historical account information preserved
All access history preserved
Deletion event logged
