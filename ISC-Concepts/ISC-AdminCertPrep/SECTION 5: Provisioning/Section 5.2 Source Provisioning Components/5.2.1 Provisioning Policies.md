
# Section 5.2: Source Provisioning Components

**Master the components that enable provisioning in ISC sources**

---

## Table of Contents

- [5.2.1 Provisioning Policies](#521-provisioning-policies)
- [5.2.2 Create, Update, Delete Operations](#522-create-update-delete-operations)
- [5.2.3 Account Schemas and Attributes](#523-account-schemas-and-attributes)

---

# 5.2.1 Provisioning Policies

**Learning Objective:** Understand provisioning policies and how they control provisioning behavior.

---

## What is a Provisioning Policy?

**Definition:** Configuration that defines how ISC provisions to a specific source

**Purpose:**
```
Provisioning Policy determines:
  - Can this source be provisioned?
  - What operations are allowed? (Create, Modify, Delete)
  - What attributes to provision?
  - What provisioning method to use?
  - When provisioning occurs?
```

**Simple concept:**
```
Provisioning Policy = Rules for how ISC provisions to a source

Example:
  Source: Active Directory
  Provisioning Policy: Defines how to create/modify/delete AD accounts
```

**Exam Tip:** Provisioning policy configures HOW provisioning happens for a source. Each source has its own provisioning policy.

---

## Provisioning Policy Components

### **Core Settings**

**1. Provisioning Enabled/Disabled**
```
Setting: Enable provisioning for this source?

Options:
  ✓ Enabled: ISC can provision to this source
  ✗ Disabled: ISC cannot provision (read-only)

Example:
  Active Directory: Enabled (can provision)
  HR System (Workday): Disabled (read-only, authoritative source)
```

**Why disable provisioning:**
```
Authoritative sources:
  - Workday (HR data)
  - SuccessFactors
  - HR databases
  
  Reason: ISC reads from these, doesn't write to them
  
Read-only sources:
  - Legacy systems
  - Sources being decommissioned
  - Testing/staging environments
  
  Reason: Don't want ISC making changes
```

---

**2. Allowed Operations**

**Configure which operations permitted:**

| Operation | What It Does | When Enabled |
|-----------|-------------|--------------|
| **Create** | Create new accounts | New hires, new access |
| **Update** | Modify existing accounts | Attribute changes, group adds |
| **Delete** | Remove accounts | Terminations, access removal |
| **Enable** | Activate accounts | Return from leave |
| **Disable** | Deactivate accounts | Termination, leave |

**Example configurations:**

**Configuration 1: Full Provisioning**
```
Source: Active Directory (production)

Allowed Operations:
  ✓ Create (new accounts)
  ✓ Update (modify attributes, groups)
  ✓ Enable (re-enable accounts)
  ✓ Disable (terminate/suspend)
  ✓ Delete (after retention period)

Use Case: Primary account source, full lifecycle
```

**Configuration 2: Create and Update Only**
```
Source: Salesforce

Allowed Operations:
  ✓ Create (new accounts)
  ✓ Update (modify profiles, licenses)
  ✗ Delete (never delete, just disable)
  ✓ Enable (activate accounts)
  ✓ Disable (deactivate)

Use Case: Keep all historical data, never delete
```

**Configuration 3: Update Only**
```
Source: Active Directory (testing)

Allowed Operations:
  ✗ Create (accounts pre-created manually)
  ✓ Update (can modify attributes)
  ✗ Delete (never delete test accounts)

Use Case: Testing environment, pre-existing accounts
```

---

**3. Provisioning Method**

**How ISC provisions:**

**Method 1: Direct Provisioning (Cloud Sources)**
```
ISC → API Call → Target System

Example - Salesforce:
  ISC calls Salesforce API directly
  No VA required
  Real-time provisioning
  
Advantages:
  ✓ Fast (direct connection)
  ✓ No VA dependency
  ✓ Simple architecture
  
Use Cases:
  - Cloud SaaS apps
  - Modern applications with APIs
```

**Method 2: VA-Based Provisioning (On-Premises)**
```
ISC → VA → Target System

Example - Active Directory:
  ISC sends command to VA
  VA executes PowerShell/LDAP
  VA reports result to ISC
  
Advantages:
  ✓ Can reach on-premises systems
  ✓ Secure (no inbound connections)
  
Disadvantages:
  ✗ Slower (VA in middle)
  ✗ VA dependency
  
Use Cases:
  - Active Directory
  - On-premises databases
  - Legacy systems
```

**Method 3: File-Based Provisioning**
```
ISC → Generate File → Target System Imports

Example - HR System:
  ISC generates CSV file
  File placed on SFTP server
  HR system imports file nightly
  
Advantages:
  ✓ Works with legacy systems
  ✓ Batch processing
  
Disadvantages:
  ✗ Delayed (not real-time)
  ✗ Manual coordination needed
  
Use Cases:
  - Legacy systems without APIs
  - Batch processing requirements
```

---

**4. Provisioning Timing**

**When provisioning executes:**

**Real-time (Immediate):**
```
Trigger → Provisioning executes immediately

Example:
  User lifecycle changes to active
    ↓
  Within minutes: AD account created
  
Use Cases:
  ✓ High-priority provisioning (new hires)
  ✓ Security-critical (de-provisioning)
  ✓ User-requested access
  
Duration: Minutes
```

**Scheduled (Batch):**
```
Trigger → Queued → Executes at scheduled time

Example:
  User assigned role at 10 AM
    ↓
  Queued for next batch
    ↓
  Batch runs at 2 PM
    ↓
  Account created at 2 PM
  
Use Cases:
  ✓ Bulk operations
  ✓ Low-priority changes
  ✓ System resource management
  
Duration: Hours (until next batch)
```

**Configuration:**
```
Provisioning Policy Settings:

Real-time Operations:
  - Account creation (new hires)
  - Account disabling (terminations)
  - High-risk access grants
  
Batch Operations:
  - Bulk group updates
  - Attribute synchronization
  - Non-urgent changes
  
Schedule:
  Batch Window: Every 2 hours
  Next Run: :00 minutes past the hour
```

---

**5. Attribute Mapping**

**Which attributes to provision:**
```
Provisioning Policy defines:
  - Which ISC attributes map to source attributes
  - Which attributes are provisioned
  - Default values
  - Transforms/calculations
```

**Example - Active Directory:**
```
ISC Attribute → AD Attribute

firstName → givenName
lastName → sn
email → mail
displayName → displayName (firstName + " " + lastName)
department → department
manager → manager (DN lookup)
employeeID → employeeID
```

**Provisioning behavior:**
```
When creating AD account:
  
ISC has identity:
  firstName: "John"
  lastName: "Smith"
  email: "john.smith@company.com"
  department: "Sales"
  
Provisioning Policy maps:
  givenName = "John"
  sn = "Smith"
  mail = "john.smith@company.com"
  department = "Sales"
  displayName = "John Smith" (calculated)
  
AD account created with these attributes
```

---

**6. Before/After Provisioning Rules**

**Custom logic before/after provisioning:**

**Before Provisioning Rules:**
```
Execute before account creation

Use Cases:
  - Validate data
  - Generate username (if not provided)
  - Check for conflicts
  - Calculate attributes
  
Example:
  Before creating AD account:
    1. Check if username already exists
    2. If exists, append number (john.smith2)
    3. Proceed with creation
```

**After Provisioning Rules:**
```
Execute after account creation

Use Cases:
  - Verify success
  - Trigger additional actions
  - Send notifications
  - Update external systems
  
Example:
  After creating AD account:
    1. Verify account created successfully
    2. Send welcome email to user
    3. Create ticket for equipment
    4. Update HR system with AD username
```

---

## Provisioning Policy Examples

### **Example 1: Active Directory (Full Lifecycle)**
```yaml
Source: Active Directory

Provisioning Policy:
  
  Enabled: Yes
  
  Allowed Operations:
    Create: Yes
    Update: Yes
    Enable: Yes
    Disable: Yes
    Delete: Yes (after 90 days)
  
  Provisioning Method: Via Virtual Appliance
  
  Timing:
    Create: Real-time (immediate)
    Update: Real-time
    Disable: Real-time (urgent)
    Delete: Scheduled (90 days post-termination)
  
  Attribute Mappings:
    sAMAccountName: identity.uid
    givenName: identity.firstName
    sn: identity.lastName
    displayName: identity.displayName
    mail: identity.email
    department: identity.department
    employeeID: identity.employeeNumber
    manager: identity.manager (DN lookup)
  
  OU Placement:
    Default: OU=Users,DC=company,DC=com
    By Department:
      Sales: OU=Sales,OU=Users,DC=company,DC=com
      IT: OU=IT,OU=Users,DC=company,DC=com
  
  Default Groups:
    - All-Employees
    - Domain Users
    
  Password Policy:
    Generate: Random, 16 characters
    Must Change: On first login
    
  Before Provisioning:
    - Check username uniqueness
    - Validate email format
    
  After Provisioning:
    - Send welcome email
    - Add to security groups based on department
```

---

### **Example 2: Salesforce (Create and Update Only)**
```yaml
Source: Salesforce

Provisioning Policy:
  
  Enabled: Yes
  
  Allowed Operations:
    Create: Yes
    Update: Yes
    Enable: Yes
    Disable: Yes
    Delete: No (never delete, historical data)
  
  Provisioning Method: Direct API
  
  Timing:
    Create: Real-time
    Update: Real-time
    Disable: Real-time
  
  Attribute Mappings:
    Username: identity.email
    Email: identity.email
    FirstName: identity.firstName
    LastName: identity.lastName
    Department: identity.department
    ProfileId: Based on department (rule)
    UserRoleId: Based on title (rule)
  
  Default Settings:
    Profile: Standard User
    License: Sales Cloud
    TimeZone: America/New_York
    Locale: en_US
    
  Profile Assignment Rules:
    IF department = "Sales" → Profile: Sales User
    IF department = "IT" → Profile: System Administrator
    ELSE → Profile: Standard User
  
  After Provisioning:
    - Assign to default permission sets
    - Notify user with login instructions
```

---

### **Example 3: Workday (Read-Only, No Provisioning)**
```yaml
Source: Workday (HR System)

Provisioning Policy:
  
  Enabled: No
  
  Reason: Authoritative source, read-only
  
  ISC Behavior:
    Aggregation: Yes (read employee data)
    Provisioning: No (never write to HR)
  
  Note: 
    HR owns employee data
    ISC consumes data only
    All updates made in Workday
```

---

## Provisioning Policy Best Practices

### **Design Principles**

**1. Least Privilege**
```
Enable only operations needed:

✓ Good:
  Source: Application
  Create: Yes (need to create accounts)
  Update: Yes (need to modify)
  Delete: No (application keeps historical data)

✗ Bad:
  Source: Application
  Create: Yes
  Update: Yes
  Delete: Yes (enabled but never used = unnecessary risk)
```

---

**2. Authoritative Sources Read-Only**
```
✓ Good:
  Source: Workday (HR)
  Provisioning: Disabled
  Reason: Authoritative source
  
✗ Bad:
  Source: Workday
  Provisioning: Enabled
  Reason: ISC should never modify HR data
```

---

**3. Real-time for Security**
```
✓ Good:
  Operations requiring immediate execution:
    - Account creation (new hires)
    - Account disabling (terminations)
    - Access revocation (security)
  Timing: Real-time
  
✗ Bad:
  Termination provisioning: Batch (runs every 4 hours)
  Risk: Terminated employee has access for hours
```

---

**4. Document Policies**
```
✓ Good:
  Provisioning Policy: Active Directory
  Operations: Create, Update, Disable, Delete
  Timing: Real-time except Delete (90 days)
  Notes: 
    - Delete delayed for retention
    - Manager DN looked up from employeeId
  Last Updated: 2024-02-14
  Owner: IAM Team
```

---

**5. Test Before Production**
```
Process:
  1. Configure policy in test/sandbox
  2. Test each operation (create, update, delete)
  3. Verify attribute mappings
  4. Test error handling
  5. Deploy to production
  6. Monitor first provisioning operations
```

---

## Practice Exercise

**Question:** You're configuring a provisioning policy for Active Directory. What operations should you enable and what timing should you use for each?

<details>
<summary>Answer</summary>

**Recommended Active Directory Provisioning Policy:**

---

**Operations Configuration:**

**1. Create - ENABLED (Real-time)**
```
Enabled: Yes
Timing: Real-time (immediate)

Why Enabled:
  ✓ Need to create accounts for new hires
  ✓ Need to create accounts for access requests
  ✓ Core provisioning requirement
  
Why Real-time:
  ✓ New employees need access on day one
  ✓ Cannot wait for batch processing
  ✓ Business expectation: immediate provisioning
  
Use Cases:
  - New hire starts (lifecycle: prehire → active)
  - User requests AD account
  - Contractor onboarding
  
Example:
  Employee starts today at 8 AM
  Lifecycle changes at 2 AM (aggregation)
  AD account created at 2:05 AM
  Ready for employee arrival
```

---

**2. Update - ENABLED (Real-time)**
```
Enabled: Yes
Timing: Real-time (immediate)

Why Enabled:
  ✓ Attributes change (department, manager, title)
  ✓ Group memberships change
  ✓ Keep AD synchronized with ISC
  
Why Real-time:
  ✓ Department changes need immediate group updates
  ✓ Manager changes affect access
  ✓ Keep data current
  
Use Cases:
  - Department transfer (Sales → IT)
  - Promotion (update title)
  - Manager change
  - Group membership changes
  
Update Operations Include:
  - Modify attributes (department, title, manager)
  - Add to groups
  - Remove from groups
  - Update contact information
  
Example:
  Employee transfers IT → Sales
  Workday aggregates
  ISC updates AD:
    - Department: IT → Sales
    - Remove from: IT-All group
    - Add to: Sales-Team group
  Completed within minutes
```

---

**3. Enable - ENABLED (Real-time)**
```
Enabled: Yes
Timing: Real-time (immediate)

Why Enabled:
  ✓ Re-enable accounts after leave
  ✓ Re-enable accidentally disabled accounts
  ✓ Support return from leave workflow
  
Why Real-time:
  ✓ Employee returning from leave needs immediate access
  ✓ Cannot wait for batch
  
Use Cases:
  - Return from leave (leave → active)
  - Accidentally disabled, need to re-enable
  - Account reactivation
  
Example:
  Employee returns from maternity leave
  Lifecycle: leave → active
  Return workflow triggers:
    - Enable AD account
    - Remove "Account is disabled" flag
    - User can log in immediately
```

---

**4. Disable - ENABLED (Real-time, URGENT)**
```
Enabled: Yes
Timing: Real-time (IMMEDIATE - highest priority)

Why Enabled:
  ✓ Must disable accounts on termination
  ✓ Must disable for leave of absence
  ✓ Security requirement
  
Why Real-time (URGENT):
  ✓ Security critical
  ✓ Terminated employee must lose access immediately
  ✓ Cannot tolerate any delay
  ✓ Compliance requirement
  
Priority: HIGHEST (executed before other operations)
  
Use Cases:
  - Termination (active → inactive)
  - Leave of absence (active → leave)
  - Security incident (immediate revocation)
  
Example:
  Employee terminated today
  Lifecycle: active → inactive
  Leaver workflow triggers:
    - Disable AD account (within 2 minutes)
    - User cannot log in
    - Active sessions may be terminated (GPO)
    - VPN disconnected
  
Security Impact:
  ✓ Immediate access revocation
  ✓ No window for malicious activity
  ✓ Compliance satisfied
```

---

**5. Delete - ENABLED (Scheduled/Delayed)**
```
Enabled: Yes
Timing: Scheduled (90 days after disable)

Why Enabled:
  ✓ Cleanup old disabled accounts
  ✓ Reduce account sprawl
  ✓ Free up usernames
  ✓ Compliance (data retention end)
  
Why Delayed (90 days):
  ✓ Retention period for data access
  ✓ Manager may need to access files
  ✓ Legal hold considerations
  ✓ Re-hire possibility
  
Why NOT Immediate:
  ✗ Data would be lost
  ✗ Manager can't access forwarded email
  ✗ May violate retention policy
  ✗ Cannot recover if mistake
  
Process:
  Day 0: Disable account (immediate)
  Day 1-89: Account disabled, data preserved
  Day 90: Delete account (scheduled job)
  
Deletion Schedule:
  Job: "Delete accounts disabled >90 days"
  Frequency: Weekly (Sunday 3 AM)
  Checks:
    - Account disabled for 90+ days?
    - No legal holds?
    - No active tickets?
    - Retention period complete?
  Then: Delete account
  
Example:
  Employee terminated: Feb 14, 2024
  Account disabled: Feb 14, 2024 (Day 0)
  Account deleted: May 14, 2024 (Day 90)
  
  Deletion job runs May 19, 2024 (Sunday)
    - Finds account disabled 94 days ago
    - No holds
    - Deletes account
```

---

**Complete Configuration:**
```yaml
Source: Active Directory

Provisioning Policy:
  
  Enabled: Yes
  Method: Virtual Appliance
  
  Operations:
  
    Create:
      Enabled: Yes
      Timing: Real-time
      Priority: High
      Retry: 3 attempts
      
    Update:
      Enabled: Yes
      Timing: Real-time
      Priority: Medium
      Retry: 3 attempts
      Batch Updates: Group to reduce load
      
    Enable:
      Enabled: Yes
      Timing: Real-time
      Priority: High
      Retry: 2 attempts
      
    Disable:
      Enabled: Yes
      Timing: Real-time
      Priority: CRITICAL (highest)
      Retry: 5 attempts (ensure success)
      Alert on Failure: Yes (immediate)
      
    Delete:
      Enabled: Yes
      Timing: Scheduled (90 days post-disable)
      Schedule: Weekly (Sunday 3 AM)
      Conditions:
        - Disabled for 90+ days
        - No legal holds
        - No active tickets
        - Retention period complete
      Approval: Automatic (if conditions met)
      Notification: IT Team (weekly summary)
```

---

**Why This Configuration:**

**Security:**
```
✓ Disable is real-time and highest priority
  - Immediate access revocation
  - Security incidents handled instantly
  - Compliance satisfied

✓ Delete is delayed
  - Data preserved for transition
  - No accidental data loss
  - Meets retention requirements
```

**Business Continuity:**
```
✓ Create and Enable are real-time
  - New hires ready on day one
  - Returns from leave have immediate access
  - Business productivity maintained

✓ Update is real-time
  - Department transfers processed quickly
  - Access changes immediate
  - Data stays current
```

**Operational Efficiency:**
```
✓ Automated deletion after retention
  - Consistent enforcement
  - Reduces account sprawl
  - Frees IT from manual cleanup

✓ Batch updates for low-priority changes
  - Reduces VA load
  - Optimizes performance
  - Groups similar operations
```

**Risk Management:**
```
✓ Disable never waits (highest priority)
  - Zero tolerance for delayed revocation
  - Multiple retries ensure success
  - Alerts on failure

✓ Delete is controlled and scheduled
  - Cannot accidentally delete
  - Retention period enforced
  - Reversible during disable period
```

---

**What NOT to Enable:**

**Operations to Avoid:**

**Immediate Deletion:**
```
✗ DON'T Configure:
  Delete:
    Timing: Real-time (immediate on termination)

Why Not:
  ✗ Data lost immediately
  ✗ Cannot recover
  ✗ Manager can't access files
  ✗ Violates retention policies
  ✗ Risk of mistakes

Instead:
  ✓ Disable immediately
  ✓ Delete after retention period
```

**Batch Disable:**
```
✗ DON'T Configure:
  Disable:
    Timing: Batch (every 4 hours)

Why Not:
  ✗ Security gap (hours of access)
  ✗ Terminated employee can still log in
  ✗ Compliance violation
  ✗ Unacceptable risk

Instead:
  ✓ Disable real-time (immediate)
  ✓ Highest priority
```

---

**Exam Tip:** For AD provisioning, enable all operations but with different timing: Create/Update/Enable/Disable are real-time, Delete is delayed (90 days). Disable has highest priority for security.
</details>

---

