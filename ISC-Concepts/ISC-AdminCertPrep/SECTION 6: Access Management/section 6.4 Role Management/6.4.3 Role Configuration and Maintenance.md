## 6.4.3: Role Configuration and Maintenance

### Overview
Effective role configuration and maintenance requires understanding role composition, managing access profile relationships, maintaining role quality over time, and scaling role operations across the organization. This section covers advanced role management techniques for enterprise-scale deployments.

**What you'll learn:**
- Access profile composition strategies
- Role lifecycle management
- Bulk role operations
- Role optimization and cleanup
- Migration between environments
- Role auditing and reporting

---

### Access Profile Composition

#### Understanding Role Structure

**Hierarchy:**
```
Role
 ├── Access Profile 1
 │    ├── Entitlement A
 │    ├── Entitlement B
 │    └── Entitlement C
 ├── Access Profile 2
 │    ├── Entitlement D
 │    └── Entitlement E
 └── Access Profile 3
      └── Entitlement F
```

**Key principle:** Roles contain Access Profiles; Access Profiles contain Entitlements

---

#### Access Profile Selection Strategy

**1. Purpose-based grouping**

Group access profiles by functional capability:

**Example: "Sales Representative" role**
```json
{
  "name": "Sales Representative",
  "accessProfiles": [
    {
      "id": "...",
      "name": "Salesforce Sales User"  // CRM access
    },
    {
      "id": "...",
      "name": "Sales Shared Drive"     // File storage
    },
    {
      "id": "...",
      "name": "Marketing Portal Read"  // Marketing materials
    },
    {
      "id": "...",
      "name": "Email Distribution Groups"  // Communication
    }
  ]
}
```

**Rationale:**
- Each access profile serves distinct purpose
- Modular design allows profile reuse
- Changes to one capability don't affect others
- Clear separation of concerns

---

**2. Minimize redundancy**

Avoid including same entitlement through multiple paths:

**❌ Poor design:**
```
Role: "Engineering Manager"
├── Access Profile: "Engineering Base"
│    └── Entitlement: "Engineering AD Group"
└── Access Profile: "Manager Tools"
     └── Entitlement: "Engineering AD Group"  ← Duplicate!
```

**✅ Better design:**
```
Role: "Engineering Manager"
├── Access Profile: "Engineering Base"
│    └── Entitlement: "Engineering AD Group"
└── Access Profile: "Manager Tools"
     └── Entitlement: "Manager Dashboard"
```

**Why it matters:**
- Duplicate entitlements complicate certifications
- Removal of one profile may leave orphaned access
- Harder to audit and troubleshoot
- Inefficient provisioning

---

**3. Balance granularity vs. complexity**

**Too granular:**
```
Role: "HR Specialist"
├── Access Profile: "HRIS Read"
├── Access Profile: "HRIS Write"
├── Access Profile: "HRIS Reports"
├── Access Profile: "HRIS Admin"
├── Access Profile: "Benefits Module"
├── Access Profile: "Payroll Module"
└── ... (20 total access profiles)
```

**Problems:**
- Difficult to maintain
- Complex certifications
- Hard to understand full access scope
- Many potential update points

**Better balance:**
```
Role: "HR Specialist"
├── Access Profile: "HRIS Core Access"  // Read, Write, Reports
├── Access Profile: "Benefits Management"
└── Access Profile: "Payroll Access"
```

**Benefits:**
- Clearer role purpose
- Easier to certify
- Fewer maintenance points
- Still modular enough for flexibility

---

**4. Consider source distribution**

Spread access across different sources when appropriate:

**Example: "Remote Worker" role**
```json
{
  "name": "Remote Worker",
  "accessProfiles": [
    {
      "id": "...",
      "name": "VPN Access",           // Network source
      "source": "Cisco VPN"
    },
    {
      "id": "...",
      "name": "O365 Full Suite",      // Cloud source
      "source": "Microsoft 365"
    },
    {
      "id": "...",
      "name": "Laptop AD Group",      // On-prem source
      "source": "Active Directory"
    }
  ]
}
```

**Considerations:**
- Cross-system provisioning complexity
- Dependency management
- Rollback scenarios
- Partial provisioning handling

---

### Role Lifecycle Stages

#### Stage 1: Design

**Activities:**
- Define business purpose
- Identify target population
- Select access profiles
- Design membership criteria
- Choose ownership model

**Deliverables:**
- Role design document
- Criteria logic specification
- Access profile list
- Owner assignment
- Approval workflow design

**Best practices:**
- Involve business stakeholders
- Start with minimal viable access
- Plan for growth
- Document assumptions
- Consider certification impact

---

#### Stage 2: Development

**Activities:**
- Create role in non-production
- Configure membership criteria
- Add access profiles
- Set role properties
- Configure workflows

**Testing checklist:**
- ✅ Criteria matches expected population
- ✅ No unexpected identities included
- ✅ All access profiles provision correctly
- ✅ Approval workflows function
- ✅ Revocation works properly
- ✅ Performance acceptable

**Validation:**
- Business stakeholder review
- Security team review
- Compliance verification
- Technical validation

---

#### Stage 3: Deployment

**Activities:**
- Migrate role to production
- Enable role
- Monitor initial assignments
- Validate provisioning
- Communicate to affected users

**Deployment strategies:**

**Phased rollout:**
```
Week 1: Enable for 10% of population
Week 2: Review results, expand to 50%
Week 3: Full deployment if no issues
```

**Pilot group:**
```
1. Deploy to test group (20-50 users)
2. Monitor for 1-2 weeks
3. Gather feedback
4. Refine if needed
5. Deploy to full population
```

**Big bang:**
```
Enable role for all matching identities at once
```
*Use only for low-risk, well-tested roles*

---

#### Stage 4: Operations

**Ongoing activities:**

**Monitoring (Daily/Weekly):**
- Assignment count trends
- Unexpected additions/removals
- Provisioning failures
- Performance metrics

**Maintenance (Monthly/Quarterly):**
- Review membership criteria accuracy
- Validate access profile relevance
- Update descriptions
- Optimize performance
- Review owner assignment

**Governance (Quarterly/Annually):**
- Certification campaigns
- Access reviews
- Compliance audits
- Usage analysis
- ROI assessment

---

#### Stage 5: Optimization

**Indicators for optimization:**
- Role has too few members (< 5)
- Role has too many members (> 5000)
- High certification revocation rate (> 20%)
- Frequent manual exceptions
- Complex, unmaintainable criteria
- Overlapping access with other roles

**Optimization actions:**

**Merge underutilized roles:**
```
Before:
- "Junior Developer - Frontend" (3 members)
- "Junior Developer - Backend" (4 members)
- "Junior Developer - Mobile" (2 members)

After:
- "Junior Developer" (9 members)
```

**Split overly broad roles:**
```
Before:
- "Employee" (15,000 members, 25 access profiles)

After:
- "Employee - Base" (15,000 members, 5 core profiles)
- "Employee - Office Tools" (12,000 members, requestable)
- "Employee - Collaboration" (8,000 members, requestable)
```

**Simplify complex criteria:**
```
Before: 3-level nested AND/OR with 15 conditions
After: 2-level with 6 conditions, cover same population
```

---

#### Stage 6: Retirement

**When to retire a role:**
- Business function no longer exists
- Replaced by better role design
- Zero or near-zero membership for 90+ days
- Technology being decommissioned
- Organizational restructure

**Retirement workflow:**

**1. Analysis phase:**
```
- Document current members
- Identify dependent roles
- Plan replacement access
- Communicate to stakeholders
```

**2. Transition phase:**
```
- Assign replacement roles
- Validate equivalent access
- Monitor for gaps
- Support user questions
```

**3. Deactivation phase:**
```
- Disable role (enabled = false)
- Monitor for 30-60 days
- Verify no adverse impact
- Document lessons learned
```

**4. Removal phase:**
```
- Remove access profiles
- Monitor another 30 days
- Delete role
- Update documentation
```

---

### Bulk Role Operations

#### Use Cases for Bulk Operations

**1. Mass role creation**
- Initial role model implementation
- Department restructure
- New office/region expansion
- Application rollout

**2. Mass updates**
- Access profile additions/removals
- Ownership changes
- Description updates
- Property modifications

**3. Mass migration**
- Sandbox to production
- Tenant to tenant
- Version upgrades
- Environment refresh

---

#### Bulk Creation via API

**Scenario:** Create 50 department-based roles

**Approach:**

**Step 1: Prepare role definitions**
```json
[
  {
    "name": "Sales - North America",
    "description": "Access for Sales team in North America region",
    "owner": {"id": "2c91808a..."},
    "enabled": true,
    "requestable": false,
    "membership": {
      "type": "STANDARD",
      "criteria": {
        "operation": "AND",
        "children": [
          {"type": "IDENTITY", "key": "department", "operation": "EQUALS", "value": "Sales"},
          {"type": "IDENTITY", "key": "region", "operation": "EQUALS", "value": "North America"}
        ]
      }
    },
    "accessProfiles": [
      {"id": "2c91808b..."}
    ]
  },
  // ... 49 more roles
]
```

**Step 2: Create script to iterate**
```python
import requests
import json

API_BASE = "https://tenant.api.identitynow.com/v3"
HEADERS = {
    "Authorization": "Bearer {token}",
    "Content-Type": "application/json"
}

with open('roles.json', 'r') as f:
    roles = json.load(f)

results = []
for role in roles:
    response = requests.post(
        f"{API_BASE}/roles",
        headers=HEADERS,
        json=role
    )
    results.append({
        "name": role['name'],
        "status": response.status_code,
        "id": response.json().get('id') if response.ok else None
    })

# Log results
with open('creation_results.json', 'w') as f:
    json.dump(results, f, indent=2)
```

**Step 3: Validate results**
```python
# Check for failures
failures = [r for r in results if r['status'] != 201]
if failures:
    print(f"Failed to create {len(failures)} roles:")
    for f in failures:
        print(f"  - {f['name']}")
```

---

#### Bulk Updates via API

**Scenario:** Add new access profile to 30 existing roles

**Approach:**

**Step 1: Get current role configurations**
```python
# Fetch roles that need updating
role_pattern = "Engineering*"
response = requests.get(
    f"{API_BASE}/roles",
    headers=HEADERS,
    params={"filters": f"name co \"{role_pattern}\""}
)
roles = response.json()
```

**Step 2: Modify each role**
```python
new_access_profile = {"id": "2c91808c..."}

for role in roles:
    # Add new access profile
    role['accessProfiles'].append(new_access_profile)
    
    # Update via PATCH
    response = requests.patch(
        f"{API_BASE}/roles/{role['id']}",
        headers=HEADERS,
        json=[{
            "op": "add",
            "path": "/accessProfiles/-",
            "value": new_access_profile
        }]
    )
    
    if response.ok:
        print(f"Updated: {role['name']}")
    else:
        print(f"Failed: {role['name']} - {response.text}")
```

---

#### Export/Import for Migration

**Use case:** Move roles from sandbox to production

**Method 1: SailPoint sp-config tools**

**Export from sandbox:**
```bash
# Using VS Code extension or sp-config tool
sp-config export --object-type role --tenant sandbox
```

**Import to production:**
```bash
# Review exported JSON
# Update source IDs, access profile IDs
# Import to production
sp-config import --file roles.json --tenant production
```

**Method 2: Custom scripts**

**Export script:**
```python
# Get all roles
response = requests.get(f"{SANDBOX_API}/roles", headers=headers)
roles = response.json()

# For each role, get full details
detailed_roles = []
for role in roles:
    detail = requests.get(
        f"{SANDBOX_API}/roles/{role['id']}",
        headers=headers
    ).json()
    detailed_roles.append(detail)

# Save to file
with open('exported_roles.json', 'w') as f:
    json.dump(detailed_roles, f, indent=2)
```

**Transform script:**
```python
# Load exported roles
with open('exported_roles.json', 'r') as f:
    roles = json.load(f)

# Map sandbox IDs to production IDs
id_mapping = load_id_mapping('id_map.json')

for role in roles:
    # Remove sandbox-specific fields
    role.pop('id', None)
    role.pop('created', None)
    role.pop('modified', None)
    
    # Update owner ID
    role['owner']['id'] = id_mapping['owners'][role['owner']['id']]
    
    # Update access profile IDs
    for ap in role['accessProfiles']:
        ap['id'] = id_mapping['accessProfiles'][ap['id']]
    
    # Update source IDs in criteria if present
    # (recursive function to traverse criteria tree)
    update_criteria_sources(role.get('membership', {}), id_mapping)

# Save transformed roles
with open('production_roles.json', 'w') as f:
    json.dump(roles, f, indent=2)
```

**Import script:**
```python
# Load production-ready roles
with open('production_roles.json', 'r') as f:
    roles = json.load(f)

# Create each role
for role in roles:
    response = requests.post(
        f"{PROD_API}/roles",
        headers=prod_headers,
        json=role
    )
    
    if response.ok:
        print(f"Created: {role['name']}")
    else:
        print(f"Failed: {role['name']} - {response.text}")
```

---

### Role Optimization Techniques

#### 1. Role Mining and Consolidation

**Identify similar roles for consolidation:**

**Analysis query:**
```python
# Get all roles
roles = get_all_roles()

# Group by similar access profile sets
from collections import defaultdict

profile_groups = defaultdict(list)
for role in roles:
    profile_set = frozenset([ap['id'] for ap in role['accessProfiles']])
    profile_groups[profile_set].append(role)

# Find potential consolidations
for profiles, similar_roles in profile_groups.items():
    if len(similar_roles) > 1:
        print(f"\nSimilar roles (same access profiles):")
        for role in similar_roles:
            print(f"  - {role['name']} ({role['memberCount']} members)")
```

**Example output:**
```
Similar roles (same access profiles):
  - Marketing - North (45 members)
  - Marketing - South (38 members)
  - Marketing - East (52 members)
  - Marketing - West (41 members)

→ Consider consolidating into "Marketing Team" with regional criteria
```

---

#### 2. Access Profile Optimization

**Identify redundant access profiles in roles:**
```python
# Find access profiles used in only 1 role
ap_usage = defaultdict(list)
for role in roles:
    for ap in role['accessProfiles']:
        ap_usage[ap['id']].append(role['name'])

underutilized = {ap_id: role_list 
                 for ap_id, role_list in ap_usage.items() 
                 if len(role_list) == 1}

print(f"Found {len(underutilized)} access profiles used in only 1 role")
```

**Action:** Consider merging low-use access profiles or justifying standalone usage

---

#### 3. Criteria Simplification

**Before optimization:**
```json
{
  "operation": "OR",
  "children": [
    {
      "operation": "AND",
      "children": [
        {"type": "IDENTITY", "key": "dept", "operation": "EQUALS", "value": "Finance"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "NYC"}
      ]
    },
    {
      "operation": "AND",
      "children": [
        {"type": "IDENTITY", "key": "dept", "operation": "EQUALS", "value": "Finance"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "London"}
      ]
    },
    {
      "operation": "AND",
      "children": [
        {"type": "IDENTITY", "key": "dept", "operation": "EQUALS", "value": "Finance"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "Tokyo"}
      ]
    }
  ]
}
```

**After optimization:**
```json
{
  "operation": "AND",
  "children": [
    {"type": "IDENTITY", "key": "dept", "operation": "EQUALS", "value": "Finance"},
    {
      "operation": "OR",
      "children": [
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "NYC"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "London"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "Tokyo"}
      ]
    }
  ]
}
```

**Benefits:**
- Easier to read and maintain
- Better performance
- Simpler to extend (add new location)
- Less redundant department check

---

#### 4. Role Description Quality

**Poor description:**
```json
{
  "name": "Sales Role 1",
  "description": "Sales access"
}
```

**Good description:**
```json
{
  "name": "Sales Representative - West Region",
  "description": "Provides access to Salesforce, CRM tools, sales shared drives, and marketing portals for all Sales department employees in Western region offices (CA, OR, WA, NV, AZ). Auto-assigned based on department and region. Owner: West Regional Sales Manager."
}
```

**Elements of good description:**
- ✅ Clear purpose
- ✅ Target population
- ✅ Key access included
- ✅ Assignment method
- ✅ Owner context
- ✅ Geographic/organizational scope

---

### Role Auditing and Reporting

#### Essential Role Reports

**1. Role Inventory Report**

**Metrics:**
- Total roles
- Enabled vs. disabled
- Requestable vs. auto-assigned
- Average members per role
- Roles with zero members
- Roles created in last 90 days

**Query:**
```python
roles = get_all_roles()

report = {
    "total": len(roles),
    "enabled": len([r for r in roles if r['enabled']]),
    "disabled": len([r for r in roles if not r['enabled']]),
    "requestable": len([r for r in roles if r.get('requestable')]),
    "auto_only": len([r for r in roles if not r.get('requestable')]),
    "zero_members": len([r for r in roles if r.get('memberCount', 0) == 0]),
    "avg_members": sum(r.get('memberCount', 0) for r in roles) / len(roles)
}
```

---

**2. Role Usage Report**

**Analysis:**
- Most assigned roles (top 20)
- Least assigned roles (bottom 20)
- Roles never assigned in 90+ days
- Growth/decline trends

**Use cases:**
- Identify unused roles for retirement
- Validate role design assumptions
- Capacity planning
- Optimization priorities

---

**3. Role Complexity Report**

**Metrics:**
- Criteria nesting depth
- Number of access profiles per role
- Number of entitlements per role
- Source distribution

**Example:**
```python
complexity_scores = []
for role in roles:
    score = {
        "name": role['name'],
        "access_profiles": len(role.get('accessProfiles', [])),
        "criteria_depth": calculate_criteria_depth(role.get('membership', {})),
        "total_entitlements": get_total_entitlements(role)
    }
    complexity_scores.append(score)

# Flag high complexity
high_complexity = [s for s in complexity_scores 
                   if s['access_profiles'] > 15 
                   or s['criteria_depth'] > 2 
                   or s['total_entitlements'] > 50]
```

---

**4. Role Owner Report**

**Metrics:**
- Roles per owner
- Owners with > 10 roles
- Roles with inactive owners
- Owner distribution

**Action items:**
- Rebalance ownership
- Update inactive owners
- Ensure appropriate ownership

---

**5. Role Change Report**

**Track:**
- Roles created in period
- Roles modified in period
- Roles deleted in period
- Membership changes
- Access profile additions/removals

**Compliance value:**
- Audit trail
- Change management
- Security reviews
- Incident investigation

---

### Maintaining Role Quality

#### Quality Checklist

**Monthly reviews:**
- ✅ Verify zero-member roles still needed
- ✅ Check for duplicate or overlapping roles
- ✅ Review high-revocation-rate roles
- ✅ Validate owner assignments
- ✅ Update descriptions as needed

**Quarterly reviews:**
- ✅ Run role usage reports
- ✅ Identify optimization opportunities
- ✅ Review access profile composition
- ✅ Validate criteria still match business intent
- ✅ Check for retired entitlements

**Annual reviews:**
- ✅ Complete role model assessment
- ✅ Major optimization project
- ✅ Stakeholder interviews
- ✅ Benchmark against industry
- ✅ Strategic roadmap update

---

#### Role Quality Metrics

**Health indicators:**

**Green (healthy):**
- Member count: 10-5000
- Certification revocation rate: < 5%
- Provisioning success rate: > 95%
- Access profiles: 2-10
- Owner: Active identity
- Last modified: < 365 days

**Yellow (attention needed):**
- Member count: 5-10 or 5000-10000
- Certification revocation rate: 5-15%
- Provisioning success rate: 90-95%
- Access profiles: 1 or 10-15
- Owner: Active but high role count
- Last modified: 365-730 days

**Red (requires action):**
- Member count: < 5 or > 10000
- Certification revocation rate: > 15%
- Provisioning success rate: < 90%
- Access profiles: 0 or > 15
- Owner: Inactive identity
- Last modified: > 730 days

---

### Best Practices Summary

#### Design Best Practices

✅ **Start with business requirements** - Role should reflect actual job functions

✅ **Use modular access profiles** - Compose roles from reusable building blocks

✅ **Balance detail vs. simplicity** - 2-10 access profiles per role typically optimal

✅ **Document thoroughly** - Future administrators will thank you

✅ **Plan for change** - Roles will need updates as business evolves

---

#### Operational Best Practices

✅ **Test before production** - Always validate in non-prod environment

✅ **Monitor after deployment** - Watch first few refresh cycles closely

✅ **Version control** - Track changes to role definitions

✅ **Automate where possible** - Use APIs for bulk operations

✅ **Regular audits** - Don't set and forget

---

#### Governance Best Practices

✅ **Clear ownership** - Every role needs active, engaged owner

✅ **Regular certifications** - Validate membership and composition

✅ **Retire unused roles** - Clean up zero-member roles promptly

✅ **Measure effectiveness** - Track metrics and improve continuously

✅ **Stakeholder communication** - Keep business informed of changes

---

### Exam Tips

**Key concepts tested:**
✅ Role lifecycle stages (design → retirement)
✅ Access profile composition strategies
✅ Bulk operations via API
✅ Role optimization techniques
✅ Quality metrics and KPIs
✅ Migration between environments

**Common exam scenarios:**
- Choose appropriate optimization action for given situation
- Identify poorly designed role composition
- Determine when to consolidate vs. split roles
- Calculate role health metrics
- Plan role migration strategy
- Design role lifecycle process

**Quick reference:**

| Stage | Key Activities | Typical Duration |
|-------|---------------|------------------|
| Design | Requirements, planning | 1-2 weeks |
| Development | Build, test, validate | 2-4 weeks |
| Deployment | Production migration | 1 week |
| Operations | Monitor, maintain | Ongoing |
| Optimization | Improve, consolidate | Quarterly |
| Retirement | Deactivate, remove | 2-3 months |

**Remember:**
- Roles should have 2-10 access profiles (typical)
- Zero-member roles should be investigated
- > 15% revocation rate indicates design problem
- Regular optimization prevents role sprawl
- Migration requires ID mapping (sources, APs, owners)
- API is essential for bulk operations
- Quality metrics should be tracked and improved

---

### Practice Exercise 1: Identify Optimization Opportunity

**Scenario:**
You have these four roles:

1. "Engineering - Backend" (35 members, 8 access profiles)
2. "Engineering - Frontend" (42 members, 8 access profiles)
3. "Engineering - DevOps" (18 members, 9 access profiles)
4. "Engineering - QA" (22 members, 7 access profiles)

Analysis shows:
- All 4 roles share 6 identical access profiles
- Each has 1-3 unique access profiles
- Certification shows 95%+ approval rate for all
- All have same criteria structure (department="Engineering" AND specialty=X)

**Your task:** What optimization would you recommend and why?

<details>
<summary>Click for answer</summary>

**Recommendation: Consolidate with optional specialization**

**Option A: Single consolidated role**
```
Role: "Engineering Team"
- Access profiles: The 6 common profiles
- Criteria: department = "Engineering"
- Members: All 117 engineers

Additional requestable access profiles for specializations
```

**Option B: Base + Specialization roles**
```
Base role: "Engineering - Base" (auto-assigned)
- Access profiles: The 6 common profiles
- Criteria: department = "Engineering"

Requestable roles:
- "Engineering - Backend Tools" (unique 2 profiles)
- "Engineering - Frontend Tools" (unique 2 profiles)  
- "Engineering - DevOps Tools" (unique 3 profiles)
- "Engineering - QA Tools" (unique 1 profile)
```

**Rationale:**
- Reduces from 4 roles to 1 or 5 (depending on option)
- Eliminates redundant access profile assignments
- Option A: Simpler but less granular
- Option B: Maintains specialization control
- Both reduce certification burden
- Easier to maintain common access
- Better aligns with modular design

**Recommendation: Option B**
- Maintains visibility into specialization access
- Allows role-based reporting by specialty
- Easier to add new specialties
- Better separation of base vs. specialized access
</details>

---

### Practice Exercise 2: Design Migration Plan

**Scenario:**
You need to migrate 75 roles from sandbox to production. The environments have:
- Different source IDs (HR, AD, etc.)
- Different access profile IDs
- Different identity IDs (owners)
- Same basic structure and naming

**Your task:** Design the migration approach with steps.

<details>
<summary>Click for answer</summary>

**Migration Plan:**

**Phase 1: Preparation (Week 1)**

1. **Create ID mapping file**
```json
{
  "sources": {
    "sandbox_source_id": "prod_source_id",
    ...
  },
  "accessProfiles": {
    "sandbox_ap_id": "prod_ap_id",
    ...
  },
  "owners": {
    "sandbox_owner_id": "prod_owner_id",
    ...
  }
}
```

2. **Export sandbox roles**
- Use API to export all 75 roles
- Save complete JSON definitions
- Document any custom fields or dependencies

3. **Validate mapping completeness**
- Verify all sources exist in production
- Confirm all access profiles migrated
- Validate all owners exist in production

**Phase 2: Transformation (Week 1)**

4. **Transform role definitions**
```python
for role in roles:
    # Remove sandbox-specific fields
    remove_fields = ['id', 'created', 'modified', 'memberCount']
    for field in remove_fields:
        role.pop(field, None)
    
    # Map IDs
    role['owner']['id'] = id_map['owners'][role['owner']['id']]
    
    for ap in role['accessProfiles']:
        ap['id'] = id_map['accessProfiles'][ap['id']]
    
    # Update criteria source IDs
    if 'membership' in role:
        update_criteria_source_ids(role['membership'], id_map)
    
    # Set initially disabled for safety
    role['enabled'] = false
```

5. **Review transformed roles**
- Spot-check 10-15 roles manually
- Validate ID transformations
- Confirm structure intact

**Phase 3: Migration (Week 2)**

6. **Pilot migration (5 roles)**
- Import 5 low-risk roles
- Validate creation successful
- Enable one role
- Test assignment and provisioning
- Monitor for 2-3 days

7. **Phased production migration**
- Import remaining 70 roles (all disabled)
- Validate all created successfully
- Document any failures

**Phase 4: Activation (Weeks 3-4)**

8. **Gradual enablement**
```
Day 1: Enable 10 roles, monitor
Day 3: Enable 20 more roles, monitor  
Day 5: Enable 25 more roles, monitor
Day 7: Enable remaining 15 roles
```

9. **Post-activation validation**
- Compare member counts to sandbox
- Verify provisioning success rates
- Check for unexpected assignments
- Validate approval workflows

**Phase 5: Cleanup**

10. **Documentation and handoff**
- Document migration results
- Note any differences from sandbox
- Update role inventory
- Train administrators

**Success criteria:**
- ✅ All 75 roles created in production
- ✅ ID mappings 100% accurate
- ✅ > 95% provisioning success rate
- ✅ Member counts within 5% of sandbox
- ✅ Zero security incidents
- ✅ Stakeholder acceptance

</details>

---

### Review Questions

1. What's the typical optimal number of access profiles per role?
2. Why should you avoid duplicate entitlements across access profiles in a role?
3. What are the six stages of the role lifecycle?
4. When should a role be considered for retirement?
5. What's the difference between disabling and deleting a role during retirement?
6. Why is ID mapping critical when migrating roles between environments?
7. What are signs a role needs optimization?
8. How often should role quality metrics be reviewed?

<details>
<summary>Click for answers</summary>

1. **2-10 access profiles** - Enough for modularity, not so many as to be complex

2. **Avoid duplicate entitlements because:**
   - Complicates certifications (same access appears multiple times)
   - Harder to audit and troubleshoot
   - Removal of one profile may leave orphaned access
   - Inefficient provisioning

3. **Six lifecycle stages:**
   - Design
   - Development
   - Deployment
   - Operations
   - Optimization
   - Retirement

4. **Retire a role when:**
   - Business function no longer exists
   - Replaced by better design
   - Zero/near-zero members for 90+ days
   - Technology being decommissioned
   - Organizational restructure

5. **Disable vs. Delete:**
   - **Disable**: Stops new assignments, keeps existing, reversible
   - **Delete**: Immediate revocation, permanent removal, cannot undo

6. **ID mapping critical because:**
   - Source IDs differ between environments
   - Access Profile IDs are environment-specific
   - Owner identity IDs are unique per tenant
   - Without mapping, roles reference non-existent objects

7. **Signs role needs optimization:**
   - < 5 or > 5000 members
   - > 15% certification revocation rate
   - < 90% provisioning success
   - 15+ access profiles
   - Complex 3-level nested criteria
   - Last modified > 2 years ago

8. **Review frequency:**
   - **Monthly**: Basic health metrics, zero-member roles
   - **Quarterly**: Usage reports, optimization opportunities
   - **Annually**: Complete role model assessment
</details>

---

### Key Takeaways

✅ **Access profiles should be modular** - Reusable, purpose-based groupings of 2-7 entitlements

✅ **Roles have six lifecycle stages** - Design → Development → Deployment → Operations → Optimization → Retirement

✅ **Bulk operations require APIs** - UI suitable for individual roles, API essential for scale

✅ **Migration needs ID mapping** - Sources, access profiles, and owners have different IDs per environment

✅ **Quality metrics drive optimization** - Track member counts, revocation rates, provisioning success

✅ **Regular audits prevent role sprawl** - Monthly/quarterly reviews keep role model healthy

✅ **Retirement is multi-phase** - Disable → Monitor → Remove profiles → Delete (over 2-3 months)

✅ **Documentation is critical** - Clear descriptions and change logs essential for maintenance

---

**Congratulations!** You've completed Section 6.4: Role Management. You now understand automated role assignment criteria, role membership rules, and comprehensive role configuration and maintenance strategies.

**Next Section:** 6.5 - Access Management Troubleshooting - We'll cover common access management errors, troubleshooting methodologies, and resolving assignment and provisioning issues.
