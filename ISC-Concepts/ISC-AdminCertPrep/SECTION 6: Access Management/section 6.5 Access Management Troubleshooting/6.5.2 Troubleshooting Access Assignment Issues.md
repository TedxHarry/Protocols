## 6.5.2: Troubleshooting Access Assignment Issues

### Overview
Access assignment troubleshooting in SailPoint ISC requires understanding the complete flow from role criteria evaluation through provisioning execution. This section provides specific diagnostic techniques, step-by-step troubleshooting workflows, and tools for resolving assignment problems systematically.

**What you'll learn:**
- Diagnostic techniques for assignment issues
- Step-by-step troubleshooting workflows
- Using ISC tools and APIs for debugging
- Access discrepancy resolution
- Timing and sequencing issues
- Manual intervention procedures

---

### Understanding Access Assignment Flow

#### Complete Assignment Sequence
```
1. Source Aggregation
   ↓
2. Identity Refresh
   ↓
3. Role Criteria Evaluation
   ↓
4. Role Assignment/Revocation
   ↓
5. Provisioning Plan Creation
   ↓
6. Provisioning Execution
   ↓
7. Target System Update
   ↓
8. Confirmation Aggregation
```

**Key insight:** Problems can occur at ANY step. Effective troubleshooting requires identifying WHICH step failed.

---

### Diagnostic Technique 1: Identity Attribute Inspection

#### When to Use
- Role not assigning when it should
- Role assigning to wrong identities
- Inconsistent assignment behavior

#### How to Inspect

**Step 1: Access identity details**
```
Admin → Identities → Search for identity → Select identity
```

**Step 2: Review all attributes**
```
Attributes tab shows:
- Identity attribute name
- Current value
- Source of value
- Last updated timestamp
```

**Step 3: Compare to role criteria**
```
Role criteria: department = "Engineering"
Identity value: department = "engineering" ← Case mismatch!
```

#### Common Findings

**Finding 1: Case sensitivity**
```
Criteria expects: "Finance"
Identity has: "finance"
Result: No match
```

**Finding 2: Whitespace**
```
Criteria expects: "Sales"
Identity has: "Sales " ← Trailing space
Result: No match
```

**Finding 3: Null values**
```
Criteria expects: location = "Austin"
Identity has: location = null
Result: No match
```

**Finding 4: Unexpected format**
```
Criteria expects: employeeType = "Full-time"
Identity has: employeeType = "FT"
Result: No match
```

#### Resolution Strategies

**Strategy 1: Fix source data**
```
Correct data at the source system
Wait for next aggregation
Identity refresh picks up corrected value
Role assignment evaluates with correct data
```

**Strategy 2: Add transform**
```json
{
  "type": "lower",
  "input": {
    "type": "identityAttribute",
    "attributes": {
      "name": "department"
    }
  }
}
```

**Strategy 3: Update criteria**
```json
// Before (strict):
{
  "type": "IDENTITY",
  "key": "department",
  "operation": "EQUALS",
  "value": "Engineering"
}

// After (flexible):
{
  "type": "IDENTITY",
  "key": "department_normalized",  // Uses transform
  "operation": "EQUALS",
  "value": "engineering"  // Lowercase
}
```

---

### Diagnostic Technique 2: Role Assignment Timeline Analysis

#### When to Use
- Delayed role assignment
- Role assignment timing inconsistent
- Need to understand when assignment occurred

#### How to Analyze

**Step 1: Check identity last refresh**
```
Admin → Identities → [Identity] → Details
Look for: Last Refresh timestamp
```

**Step 2: Check role last modified**
```
Admin → Roles → [Role] → Details
Look for: Modified timestamp
```

**Step 3: Review activity log**
```
Admin → Dashboard → Activity
Filter:
- Type: Role Assignment
- Identity: [specific identity]
- Date range: Last 30 days

Review:
- When was role assigned?
- What triggered assignment?
- Were there any failures?
```

**Step 4: Compare timestamps**
```
Scenario:
- Role criteria updated: 2024-02-10 10:00 AM
- Identity last refreshed: 2024-02-09 3:00 PM
- Role not assigned to identity

Problem: Identity hasn't refreshed since role criteria changed!

Solution: Trigger identity refresh
```

#### Common Timing Issues

**Issue 1: Stale identity data**
```
Identity attributes updated in source: Feb 10
Last aggregation: Feb 5
Identity refresh: Feb 5
Result: ISC doesn't know about Feb 10 changes yet

Fix: Run source aggregation
```

**Issue 2: Role created after last identity refresh**
```
Last identity refresh: 9:00 AM
Role created: 10:00 AM
Result: Role criteria never evaluated for identity

Fix: Wait for next scheduled refresh OR trigger manual refresh
```

**Issue 3: Criteria modified but not saved**
```
Admin edited criteria: 2:00 PM
Admin clicked Cancel instead of Save
Result: Changes not applied

Fix: Re-edit and ensure Save clicked
```

---

### Diagnostic Technique 3: Access Profile and Entitlement Verification

#### When to Use
- Role assigned but access not provisioned
- Partial provisioning (some entitlements granted, some not)
- Provisioning status shows "completed" but user can't access

#### How to Verify

**Step 1: Check role composition**
```
Admin → Roles → [Role] → Access Profiles tab

Verify:
✓ At least 1 access profile present
✓ Access profiles are enabled
✓ Access profiles contain entitlements
```

**Step 2: Check access profile details**
```
Admin → Access Profiles → [Profile]

Verify:
✓ enabled = true
✓ Entitlements list not empty
✓ Source is correct
✓ Entitlements still exist in source
```

**Step 3: Check entitlement status**
```
Admin → Sources → [Source] → Entitlements tab
Search for each entitlement in access profile

Verify:
✓ Entitlement exists
✓ Entitlement active
✓ Native identity value correct
✓ Requestable (if relevant)
```

**Step 4: Check identity's actual access**
```
Admin → Identities → [Identity] → Access tab

Review:
- All entitlements from role present?
- Any missing?
- Any provisioning failures?
```

#### Common Access Profile Issues

**Issue 1: Disabled access profile**
```
Role: Enabled ✓
Access Profile: Disabled ✗

Result: Role assigns but access profile doesn't provision

Fix:
Admin → Access Profiles → [Profile]
enabled: true
Save
```

**Issue 2: Empty access profile**
```
Role: Enabled ✓
Access Profile: Enabled ✓ but 0 entitlements

Result: Role assigns but no actual access granted

Fix:
Admin → Access Profiles → [Profile] → Entitlements
Add required entitlements
Save
```

**Issue 3: Stale entitlement reference**
```
Access profile references: "CN=VPN-Users,OU=Groups,DC=corp,DC=local"
Entitlement in ISC: Deleted (group removed from AD last month)

Result: Provisioning fails - entitlement doesn't exist

Fix:
Admin → Sources → [AD Source] → Aggregation
Run entitlement aggregation
Update access profile with current entitlements
```

---

### Diagnostic Technique 4: Provisioning Plan Review

#### When to Use
- Access request approved but not provisioned
- Role assigned but entitlements not granted
- Need to understand what ISC attempted to provision

#### Understanding Provisioning Plans

**Provisioning plan:** ISC's internal representation of what changes need to be made on target systems.

**Components:**
- Identity: Who is receiving access
- Account requests: Account create/modify/delete operations
- Attribute requests: Attribute updates
- Provisioning target: Which source/application
- Status: Pending, In Progress, Completed, Failed

#### How to Review

**Step 1: Find provisioning plan**
```
Method 1 - Via access request:
Admin → Access Requests → [Request ID]
Click provisioning task link
View provisioning plan details

Method 2 - Via identity:
Admin → Identities → [Identity] → Activity tab
Filter: Type = Provisioning
Click to view plan
```

**Step 2: Analyze plan contents**
```json
{
  "identity": "john.smith",
  "accountRequests": [
    {
      "application": "Active Directory",
      "operation": "Modify",
      "attributeRequests": [
        {
          "name": "memberOf",
          "operation": "Add",
          "value": "CN=VPN-Users,OU=Groups,DC=corp,DC=local"
        }
      ]
    }
  ],
  "status": "Failed",
  "errors": [
    "Group 'VPN-Users' not found"
  ]
}
```

**Step 3: Identify failure point**
```
Check:
- Which operation failed? (Create, Modify, Delete, Add)
- Which application?
- Which attribute/entitlement?
- Error message?
- Timestamp of failure?
```

#### Common Provisioning Plan Issues

**Issue 1: Account doesn't exist yet**
```
Provisioning plan:
1. Add user to group "Engineering-Team"
   
Error: "Account 'john.smith' not found in Active Directory"

Problem: Trying to modify account that doesn't exist yet

Root cause:
- Role assigns entitlement
- But user doesn't have AD account yet
- Entitlement provisioning attempted before account creation

Solution:
1. Ensure account creation provisioned first
2. Then retry entitlement provisioning
   OR
3. Configure role to also create account if missing
```

**Issue 2: Insufficient permissions**
```
Provisioning plan:
1. Create account in OU=Executives,DC=corp,DC=local

Error: "Access denied - insufficient permissions"

Problem: ISC service account can create users in OU=Users
         but NOT in OU=Executives

Solution:
Grant ISC service account permissions to OU=Executives
OR
Update provisioning to use different OU
```

**Issue 3: Missing required attributes**
```
Provisioning plan:
1. Create user account
   - sAMAccountName: john.smith
   - displayName: John Smith

Error: "Cannot create object - required attribute 'userPrincipalName' not specified"

Problem: AD requires userPrincipalName but provisioning plan didn't include it

Solution:
Update provisioning policy to include all required attributes
```

---

### Diagnostic Technique 5: Manual Assignment Testing

#### When to Use
- Automated assignment not working
- Need to isolate whether problem is criteria or provisioning
- Testing before enabling auto-assignment

#### How to Test

**Step 1: Manually assign role**
```
Admin → Identities → [Test Identity] → Roles tab
Click "Add Role"
Select role
Click "Assign"
```

**Step 2: Monitor provisioning**
```
Watch for:
- Provisioning task created?
- Task status: Pending → In Progress → Completed/Failed
- Any errors in task details?
- Entitlements appear in identity's Access tab?
```

**Step 3: Verify on target system**
```
Log into target system directly
Check:
- Account exists?
- Entitlements granted?
- Attributes correct?
```

**Step 4: Compare results**
```
Manual assignment worked?
  YES → Problem is with auto-assignment criteria
  NO → Problem is with provisioning/access profiles
```

#### Interpreting Test Results

**Result A: Manual works, auto doesn't**
```
Conclusion: Provisioning is fine, criteria is wrong

Next steps:
1. Review identity attributes
2. Check criteria logic
3. Test criteria with search
4. Fix criteria
```

**Result B: Manual fails, auto fails**
```
Conclusion: Provisioning problem, not criteria

Next steps:
1. Check provisioning plan errors
2. Review access profile configuration
3. Verify entitlements exist
4. Check target system permissions
```

**Result C: Manual works intermittently**
```
Conclusion: Timing or environmental issue

Next steps:
1. Check for replication delays
2. Review target system load
3. Check network connectivity
4. Look for timeout errors
```

---

### Diagnostic Technique 6: API-Based Debugging

#### When to Use
- Need detailed technical information
- UI doesn't show enough detail
- Troubleshooting complex scenarios
- Bulk analysis required

#### Useful API Calls

**1. Get identity with all roles**
```bash
GET /v3/identities/{identityId}?expand=roles

Response shows:
- All currently assigned roles
- Assignment dates
- Assignment sources (auto vs manual)
```

**2. Search identities by criteria**
```bash
POST /v3/search
{
  "indices": ["identities"],
  "query": {
    "query": "department:Engineering AND location:Austin"
  }
}

Use to test if criteria matches expected identities
```

**3. Get role details**
```bash
GET /v3/roles/{roleId}

Response shows:
- Full role configuration
- Access profiles included
- Membership criteria
- enabled/requestable status
```

**4. Get provisioning status**
```bash
GET /v3/account-activities?filters=identityId eq "{identityId}"

Response shows:
- All provisioning activities for identity
- Status of each
- Error messages if failed
```

**5. Test transform**
```bash
POST /v3/transforms/evaluate
{
  "transform": {transform_definition},
  "attributes": {test_data}
}

Use to test if transform produces expected output
```

#### Example API Debugging Session

**Scenario:** Role "Engineering-Austin" not assigning to John Smith

**Step 1: Get John's identity data**
```bash
curl https://tenant.api.identitynow.com/v3/identities/2c91808a... \
  -H "Authorization: Bearer {token}"

Response:
{
  "id": "2c91808a...",
  "name": "john.smith",
  "attributes": {
    "department": "Engineering",
    "location": "austin",  ← Lowercase!
    ...
  }
}
```

**Step 2: Get role criteria**
```bash
curl https://tenant.api.identitynow.com/v3/roles/2c91808b... \
  -H "Authorization: Bearer {token}"

Response:
{
  "id": "2c91808b...",
  "name": "Engineering-Austin",
  "membership": {
    "type": "STANDARD",
    "criteria": {
      "operation": "AND",
      "children": [
        {"type": "IDENTITY", "key": "department", "operation": "EQUALS", "value": "Engineering"},
        {"type": "IDENTITY", "key": "location", "operation": "EQUALS", "value": "Austin"}  ← Capital A!
      ]
    }
  }
}
```

**Step 3: Identified problem**
```
Criteria expects: location = "Austin" (capital A)
John has: location = "austin" (lowercase a)
Case mismatch = no assignment
```

**Step 4: Test fix with search**
```bash
# Test current (broken) criteria
POST /v3/search
{
  "indices": ["identities"],
  "query": {
    "query": "department:Engineering AND location:Austin"
  }
}
Results: 45 identities (John NOT included)

# Test case-insensitive search
POST /v3/search
{
  "indices": ["identities"],
  "query": {
    "query": "department:Engineering AND location:austin"
  }
}
Results: 52 identities (John IS included - 7 more!)
```

**Step 5: Solution**
```
Option A: Fix source data (make location consistent case)
Option B: Add transform to normalize case
Option C: Update criteria to match actual data
```

---

### Troubleshooting Workflow: Role Not Assigning

#### Complete Diagnostic Process

**Problem:** Role should assign to identity but doesn't

**Step 1: Verify identity meets criteria (5 minutes)**
```
1. Get identity attribute values
2. Get role criteria
3. Manual comparison - do attributes match criteria?
   YES → Go to Step 2
   NO → Fix attribute values or criteria
```

**Step 2: Check role configuration (3 minutes)**
```
Admin → Roles → [Role]

Verify:
✓ enabled = true
✓ Has access profiles
✓ Criteria syntax valid
✓ Criteria saved

If any NO → Fix configuration
If all YES → Go to Step 3
```

**Step 3: Check identity refresh timing (2 minutes)**
```
1. When was role criteria last modified?
2. When was identity last refreshed?
   
If identity refresh BEFORE criteria modified:
  → Trigger identity refresh
  → Wait 5-10 minutes
  → Check if role assigned
  → If YES: RESOLVED
  → If NO: Go to Step 4
```

**Step 4: Manual assignment test (5 minutes)**
```
1. Manually assign role to identity
2. Monitor provisioning
3. Check for errors

If manual works:
  → Problem is criteria evaluation
  → Review Step 1 more carefully
  → Check for edge cases (nulls, special chars)

If manual fails:
  → Problem is provisioning
  → Go to Step 5
```

**Step 5: Review access profiles (5 minutes)**
```
Check each access profile in role:
✓ Enabled?
✓ Has entitlements?
✓ Entitlements exist in source?
✓ Source accessible?

Fix any issues found
Retry assignment
```

**Step 6: Check provisioning plan (10 minutes)**
```
Find provisioning task
Review plan details
Identify error messages
Research specific error

Common errors:
- Permission denied → Grant permissions
- Object not found → Update stale references
- Required attribute missing → Add to provisioning policy
```

**Step 7: Escalate if unresolved (As needed)**
```
If steps 1-6 don't resolve:
1. Document all findings
2. Collect screenshots
3. Export configurations
4. Open support ticket with SailPoint
```

---

### Troubleshooting Workflow: Provisioning Failures

#### Complete Diagnostic Process

**Problem:** Role assigned but access not provisioned

**Step 1: Verify role actually assigned (2 minutes)**
```
Admin → Identities → [Identity] → Roles tab

Check:
- Role appears in list?
- Assignment date recent?
- Source = "Automated" or "Manual"?

If role NOT in list:
  → Go to "Role Not Assigning" workflow
If role IS in list:
  → Continue to Step 2
```

**Step 2: Check access profile status (3 minutes)**
```
Admin → Roles → [Role] → Access Profiles tab

For each access profile:
✓ enabled = true?
✓ Has entitlements?

Admin → Access Profiles → [each profile]
✓ Enabled?
✓ Entitlements list populated?

Fix any disabled profiles
Continue to Step 3
```

**Step 3: Check for provisioning tasks (5 minutes)**
```
Admin → Identities → [Identity] → Activity tab
Filter: Provisioning

Look for:
- Recent provisioning tasks?
- Status: Failed, Pending, Completed?
- Error messages?

If NO tasks found:
  → Provisioning may not have triggered
  → Check if source supports provisioning
  → Trigger manual provisioning

If tasks found with errors:
  → Go to Step 4
```

**Step 4: Analyze provisioning errors (10 minutes)**
```
Click on failed provisioning task
Review error message

Common patterns:

"Account not found":
  → Need to create account first
  → Or update account correlation

"Permission denied":
  → ISC service account needs more permissions
  → Grant required permissions on target

"Object already exists":
  → Check for duplicate accounts
  → May need to correlate existing account

"Attribute required":
  → Add missing attributes to provisioning policy
  → Or provide default values

"Timeout":
  → Target system slow/unavailable
  → Retry provisioning
  → Check network connectivity
```

**Step 5: Verify entitlements (5 minutes)**
```
Admin → Sources → [Source] → Entitlements

Search for each entitlement from access profile

Check:
✓ Entitlement exists in ISC?
✓ Last aggregated recently?
✓ Native identity correct?

If entitlements missing/stale:
  → Run entitlement aggregation
  → Wait for completion
  → Retry provisioning
```

**Step 6: Check target system (10 minutes)**
```
Log into target system directly

Verify:
- ISC service account works?
- Required permissions present?
- Target objects exist (OUs, containers, etc.)?
- No locks or restrictions?

Test manually:
- Can service account perform required operation?
- Add test user to test group
- If manual works, ISC should work
- If manual fails, fix permissions/configuration
```

**Step 7: Manual remediation (As needed)**
```
If provisioning can't be fixed immediately:

Short-term:
1. Manually grant access on target system
2. Document manual change
3. Create ticket to fix automation

Long-term:
1. Fix root cause (permissions, config, etc.)
2. Test with new user
3. Verify automated provisioning works
4. Close ticket
```

---

### Access Discrepancy Resolution

#### Identifying Discrepancies

**Discrepancy types:**

**Type 1: ISC thinks user has access, but target system doesn't**
```
ISC shows: john.smith has "VPN-Users" group
AD shows: john.smith NOT in "VPN-Users" group

Possible causes:
- Provisioning failed silently
- Manual removal on target
- Target system synchronization issue
- Account correlation wrong
```

**Type 2: Target system has access, but ISC doesn't know**
```
AD shows: john.smith in "VPN-Users" group
ISC shows: john.smith does NOT have "VPN-Users"

Possible causes:
- Manual grant on target
- Aggregation missed entitlement
- Correlation issue
- Entitlement aggregation stale
```

**Type 3: Conflicting accounts**
```
ISC shows: john.smith correlated to "CORP\jsmith"
AD shows: Both "CORP\jsmith" and "CORP\john.smith" exist

Possible causes:
- Account created manually outside ISC
- Naming convention changed
- Duplicate accounts
- Correlation rule error
```

#### Resolution Process

**Step 1: Run reconciliation**
```
Admin → Sources → [Source] → Aggregation
Type: Account + Entitlement Aggregation
Wait for completion

This updates ISC with current target state
```

**Step 2: Compare ISC to target**
```
After aggregation:
1. Check identity in ISC
2. Check account on target
3. Compare entitlements

Still different?
→ Go to Step 3

Now matching?
→ Discrepancy resolved
→ Investigate why aggregation was stale
```

**Step 3: Manual alignment**
```
Choose approach based on "truth":

If ISC is correct:
  → Re-provision from ISC
  → Force sync to target
  → Verify target matches ISC

If target is correct:
  → Update ISC to match target
  → Fix correlation if needed
  → Determine why ISC was wrong

If both wrong:
  → Determine SHOULD state
  → Update both ISC and target
  → Fix root cause
```

**Step 4: Fix root cause**
```
Common root causes:

Stale aggregation:
  → Increase aggregation frequency
  → Set up change detection
  → Enable real-time sync if available

Manual changes on target:
  → Educate admins - all changes through ISC
  → Restrict manual access
  → Set up alerts for manual changes

Provisioning failures:
  → Fix provisioning errors
  → Add monitoring/alerting
  → Regular provisioning health checks

Correlation issues:
  → Review correlation rules
  → Fix attribute mapping
  → Clean up duplicate accounts
```

---

### Exam Tips

**Key concepts tested:**
✅ Understanding access assignment flow steps
✅ Diagnostic techniques for different issue types
✅ Using identity attributes to troubleshoot criteria
✅ Provisioning plan analysis
✅ Timeline analysis for timing issues
✅ When to use manual testing
✅ API debugging techniques
✅ Discrepancy resolution approaches

**Common exam scenarios:**
- Given symptoms, identify which diagnostic technique to use
- Choose correct troubleshooting step sequence
- Identify root cause from provisioning plan errors
- Determine if problem is criteria, timing, or provisioning
- Select appropriate API call for debugging scenario

**Remember:**
- Check timing first (has identity refreshed since criteria changed?)
- Verify obvious things (role enabled? access profiles enabled?)
- Use manual assignment to isolate criteria vs provisioning issues
- Provisioning plans show what ISC tried to do
- API provides details not visible in UI
- Always verify on target system, don't just trust ISC
- Document findings for future reference
- Test fixes before applying to production

---

### Practice Exercise: Diagnose Assignment Failure

**Scenario:**
User Sarah Chen (sarah.chen@corp.com) should have "Marketing Coordinator" role but doesn't.

**Role details:**
- Name: Marketing Coordinator
- Enabled: true
- Criteria: department = "Marketing" AND title CONTAINS "Coordinator"
- Access Profiles: "Marketing Apps" (enabled, 5 entitlements)

**Sarah's identity attributes:**
- department: "Marketing"
- title: "Sr. Marketing Coordinator"
- Last refresh: 2024-02-14 09:00 AM

**Role last modified:** 2024-02-14 02:30 PM

**Your task:** What's the problem and how do you fix it?

<details>
<summary>Click for answer</summary>

**Problem identified:** Timing issue

**Analysis:**
1. Sarah's attributes match criteria:
   - department = "Marketing" ✓
   - title CONTAINS "Coordinator" ✓ (Sr. Marketing Coordinator contains Coordinator)

2. BUT: Sarah's last refresh was 09:00 AM
   Role was last modified at 02:30 PM
   
3. Sarah's identity hasn't been refreshed since role criteria was last updated!

**Root cause:**
Identity refresh happened BEFORE role modification. Role criteria has never been evaluated for Sarah because she hasn't refreshed since the role existed/changed.

**Solution:**
```
Option 1 - Manual refresh for Sarah:
Admin → Identities → sarah.chen@corp.com
Click "Refresh Identity"
Wait 2-3 minutes
Check Roles tab - should now have "Marketing Coordinator"

Option 2 - Wait for scheduled refresh:
Next scheduled identity refresh will pick it up
May take hours/days depending on schedule

Option 3 - Source aggregation (refreshes all identities):
Admin → Sources → [HR Source]
Run aggregation
All identities refresh
Sarah gets role assigned
```

**Prevention:**
After modifying role criteria that affects many users, trigger a source aggregation to immediately apply changes rather than waiting for scheduled refresh.

**Verification:**
1. After refresh, check Sarah's Roles tab
2. Should see "Marketing Coordinator" with today's assignment date
3. Check Activity tab for role assignment event
4. Verify entitlements provisioned successfully
</details>

---

### Key Takeaways

✅ **Assignment flow has 8 steps** - problems can occur at any step; identify which step failed

✅ **Identity attribute inspection** - first check if identity data matches criteria expectations

✅ **Timeline analysis** - verify identity refreshed after role criteria changes

✅ **Manual assignment testing** - isolates whether problem is criteria or provisioning

✅ **Provisioning plans** - show exactly what ISC attempted and any errors encountered

✅ **API debugging** - provides technical details not visible in UI

✅ **Timing matters** - role changes only take effect after next identity refresh

✅ **Verify on target** - always confirm access actually granted on target system

✅ **Systematic approach** - follow troubleshooting workflows to resolve efficiently

---

**Congratulations!** You've completed Section 6: Access Management. You now understand user levels, entitlements, access types, role management, and comprehensive troubleshooting techniques.

**Next Section:** Section 7: Supporting Governance - We'll cover access requests, approval workflows, certifications, and policies.
