## 7.2: Approval Workflows

### 7.2.1: Understanding Approval Flow

### Overview
Approval workflows are the gatekeeping mechanisms that ensure access requests are properly reviewed and authorized before provisioning. Understanding approval flow components, approver types, workflow configuration, and decision logic is essential for both administrators configuring workflows and for the certification exam.

**What you'll learn:**
- Core approval workflow concepts
- Approver types and resolution
- Approval schemes and modes
- Work item creation and routing
- Decision processing flow
- Approval workflow configuration
- Timeout and fallback handling

---

### Approval Workflow Fundamentals

#### What is an Approval Workflow?

**Definition:** An automated process that routes access requests to designated approvers for review and decision before provisioning occurs.

**Purpose:**
```
Why approval workflows exist:
1. Security: Prevent unauthorized access grants
2. Compliance: Create audit trail of who approved what
3. Governance: Enforce policy and business rules
4. Accountability: Ensure responsible parties validate access need
5. Risk reduction: Catch inappropriate access before provisioning
```

**Key principle:**
```
Access Request → Validation → Approval → Provisioning

No approval = No provisioning (in most configurations)
Approval is mandatory gate between request and fulfillment
```

---

#### Approval Workflow Components

**Five core components:**
```
1. Approval Scheme
   ↓
2. Approval Mode
   ↓
3. Approver Assignment
   ↓
4. Work Item Creation
   ↓
5. Decision Processing
```

**Component relationships:**
```
Request submitted
  ↓
Approval Scheme determines: Who must approve?
  (Manager, Owner, Both, Custom, etc.)
  ↓
Approval Mode determines: How do they approve?
  (Sequential, Parallel, Single)
  ↓
Approver Assignment determines: Specific approver identity
  (john.smith's manager = mike.manager)
  ↓
Work Item Created: Task sent to approver
  (Work item appears in "My Work")
  ↓
Decision Processing: Approver decides
  (Approve/Deny → Next step or provision)
```

---

### Approver Types

#### Core Approver Types in ISC

**Type 1: MANAGER**
```
Description: Identity's direct manager approves request
Lookup: requester.manager attribute
Use case: General access requests, business need validation

Resolution logic:
1. Get requester identity
2. Read manager attribute value
3. Lookup manager identity
4. Assign work item to manager

Example:
Requester: john.smith
Manager attribute: "mike.manager"
Work item assigned to: mike.manager

If no manager:
→ Use fallback approver
→ Or auto-approve (if configured)
→ Or request fails
```

**Why use MANAGER approver:**
```
Advantages:
✓ Manager knows business need
✓ Manager knows if user still in role requiring access
✓ Clear accountability (manager responsible)
✓ Supports organizational structure
✓ Common compliance requirement

Disadvantages:
✗ Manager may lack technical knowledge
✗ May not understand specific entitlements
✗ Can be bottleneck if manager has many reports
✗ Manager changes require attribute updates
```

---

**Type 2: OWNER**
```
Description: Owner of requested item approves request
Lookup: role.owner, accessProfile.owner, or entitlement.owner
Use case: Technical validation, application-specific approval

Resolution logic:
1. Get requested item (role/access profile/entitlement)
2. Read owner attribute value
3. Lookup owner identity
4. Assign work item to owner

Example:
Request: "VPN Access" role
Role owner: "network.admin"
Work item assigned to: network.admin

If no owner:
→ Use fallback approver
→ Or skip owner approval level
→ Or request fails
```

**Why use OWNER approver:**
```
Advantages:
✓ Owner understands technical requirements
✓ Owner knows who should have access
✓ Application/system specific knowledge
✓ Can validate technical prerequisites

Disadvantages:
✗ Owner may not know business need
✗ Can create bottlenecks (one owner, many requests)
✗ Potential conflict of interest
✗ May not scale well (too many items per owner)
```

---

**Type 3: SOURCE_OWNER (APP_OWNER)**
```
Description: Owner of the source application approves
Lookup: source.owner attribute
Use case: Application-level approval, system owner validation

Resolution logic:
1. Determine source application for requested access
2. Read source owner attribute
3. Assign work item to source owner

Example:
Request: Salesforce Sales User access profile
Source: Salesforce
Source owner: "crm.admin"
Work item assigned to: crm.admin

Multiple sources:
If request spans multiple sources:
→ Create work item for each source owner
→ All must approve (parallel)
→ Or sequential based on configuration
```

**Why use SOURCE_OWNER approver:**
```
Advantages:
✓ System-level visibility
✓ Understands application architecture
✓ Can validate license availability
✓ Controls access to entire application

Disadvantages:
✗ High volume (all requests for that app)
✗ May not know individual users
✗ Can be overwhelmed
✗ Broad scope (less granular)
```

---

**Type 4: GOVERNANCE_GROUP**
```
Description: Designated governance group approves
Lookup: Configured governance group identity
Use case: High-risk access, privileged access, policy exceptions

Resolution logic:
1. Lookup governance group members
2. Create single shared work item
3. Distribute to all group members
4. Any member can approve for the group

Example:
Request: Domain Admin role
Governance group: "Security Review Team"
Members: [sec.admin1, sec.admin2, sec.admin3]
Work item sent to: All 3 members
First to decide: Decision applies to entire group

Group decision rules:
- First approve = Group approved
- First deny = Group denied
- No requirement for unanimous consent
```

**Why use GOVERNANCE_GROUP approver:**
```
Advantages:
✓ Distributed workload among team members
✓ Expertise pooling (specialists review)
✓ Availability (someone always available)
✓ Segregation of duties (not single person)

Disadvantages:
✗ Coordination challenges
✗ Inconsistent decisions (different members)
✗ Potential for confusion (who is reviewing?)
✗ Requires group management
```

---

**Type 5: WORKFLOW**
```
Description: Custom workflow determines approver dynamically
Lookup: Workflow execution result
Use case: Complex approval logic, conditional routing, dynamic approvers

Resolution logic:
1. Execute configured workflow
2. Workflow evaluates request attributes
3. Workflow returns approver identity(ies)
4. Assign work item to returned approver(s)

Example:
Request: Database access
Workflow: "Risk-Based Approval Router"
Logic:
  IF riskScore > 75:
    RETURN "CISO"
  ELSE IF riskScore > 50:
    RETURN "Security Manager"
  ELSE IF department = "Finance":
    RETURN "Finance Manager"
  ELSE:
    RETURN requester.manager

Result: Dynamic approver based on context
```

**Why use WORKFLOW approver:**
```
Advantages:
✓ Maximum flexibility
✓ Complex business rules supported
✓ Dynamic routing based on any attribute
✓ Can combine multiple factors
✓ Adaptable to changing requirements

Disadvantages:
✗ Requires technical expertise to build
✗ More complex to troubleshoot
✗ Harder to document/audit
✗ Can be slower (workflow execution overhead)
✗ Requires testing and maintenance
```

---

### Approval Schemes

#### What is an Approval Scheme?

**Definition:** Defines WHO must approve the request (which approver types).

**Common approval schemes:**

| Scheme | Approvers | Levels | Use Case |
|--------|-----------|--------|----------|
| MANAGER | Manager only | 1 | Low-risk, standard access |
| OWNER | Item owner only | 1 | Technical validation |
| SOURCE_OWNER | Application owner | 1 | Application-level control |
| MANAGER_OWNER | Manager then Owner | 2 | Balanced business + technical |
| OWNER_MANAGER | Owner then Manager | 2 | Technical first, then business |
| GOVERNANCE | Governance group | 1 | High-risk, privileged access |
| WORKFLOW | Custom workflow | Variable | Complex requirements |

---

#### Single-Level Approval Schemes

**MANAGER scheme:**
```
Configuration:
approvalScheme: MANAGER
Levels: 1

Flow:
Request → Manager Approval → Provision

Example:
User: john.smith requests "VPN Access"
Manager: mike.manager
Work item: Created for mike.manager
Decision: Approve or Deny
Result: If approved → Provision immediately
```

**OWNER scheme:**
```
Configuration:
approvalScheme: OWNER
Levels: 1

Flow:
Request → Owner Approval → Provision

Example:
User: jane.doe requests "Salesforce Sales User"
Item: Salesforce Sales User access profile
Owner: crm.admin (access profile owner)
Work item: Created for crm.admin
Decision: Approve or Deny
Result: If approved → Provision immediately
```

**When to use single-level:**
```
Use cases:
- Low-risk access
- Clear approver accountability
- Fast turnaround needed
- Simple approval logic
- Standard business access

Advantages:
✓ Fast (only one approval)
✓ Simple (clear responsibility)
✓ Less approver burden

Disadvantages:
✗ Less oversight
✗ Single point of failure
✗ May not satisfy compliance for high-risk access
```

---

#### Multi-Level Approval Schemes

**MANAGER_OWNER scheme (most common):**
```
Configuration:
approvalScheme: MANAGER_OWNER
Mode: SEQUENTIAL
Levels: 2

Flow:
Request → Manager Approval → Owner Approval → Provision

Example:
User: john.smith requests "Domain Admin"
Level 1: mike.manager (john's manager)
  Decision: Approve
  Rationale: "User needs for server maintenance project"
  
Level 2: security.admin (Domain Admin role owner)
  Decision: Approve
  Rationale: "Validated with IT Director, authorized"
  
Result: Both approved → Provision

If Level 1 denies:
→ Request rejected immediately
→ Level 2 never sees request
→ No provisioning

If Level 1 approves, Level 2 denies:
→ Request rejected after Level 2
→ No provisioning
→ Both approvals required
```

**OWNER_MANAGER scheme:**
```
Configuration:
approvalScheme: OWNER_MANAGER
Mode: SEQUENTIAL
Levels: 2

Flow:
Request → Owner Approval → Manager Approval → Provision

Use case:
Technical validation first, then business validation

Example:
User: jane.doe requests "SAP Super User"
Level 1: sap.admin (technical owner)
  Validates: User has prerequisites, understands system
  Decision: Approve
  
Level 2: finance.manager (jane's manager)
  Validates: Business need, budget approval
  Decision: Approve
  
Result: Both approved → Provision

Why owner first?
- Reject technically inappropriate requests early
- Manager doesn't waste time on impossible requests
- Technical pre-qualification
```

---

### Approval Modes

#### What is Approval Mode?

**Definition:** Defines HOW approvers approve (sequential, parallel, or single).

**Three approval modes:**

---

**Mode 1: SEQUENTIAL (Serial)**
```
Description: Approvals occur one after another in order
Characteristic: Each level must complete before next begins

Visual flow:
Request
  ↓
Level 1 Approver
  ↓ (only if Level 1 approves)
Level 2 Approver
  ↓ (only if Level 2 approves)
Level 3 Approver
  ↓ (only if Level 3 approves)
Provision

Configuration:
approvalMode: SEQUENTIAL
approvalScheme: MANAGER_OWNER

Example:
Request: Engineering Manager role
Level 1: User's manager (approves business need)
  ↓ Approve (4 hours)
Level 2: Role owner (approves role fit)
  ↓ Approve (2 hours)
Provision

Total time: 6 hours
Rejection at any level: Entire request fails
```

**When to use SEQUENTIAL:**
```
Best for:
- Escalating privilege levels
- Hierarchical approval chains
- When later approvers need earlier context
- Compliance requirements (audit trail of sequence)

Advantages:
✓ Clear approval hierarchy
✓ Later approvers see earlier decisions/comments
✓ Appropriate for increasing sensitivity

Disadvantages:
✗ Slower (sum of all approval times)
✗ Bottleneck if one approver delayed
✗ Early denial wastes no further time (pro and con)
```

---

**Mode 2: PARALLEL**
```
Description: Multiple approvers review simultaneously
Characteristic: All notified at once, all must approve

Visual flow:
Request
  ↓
  ├─→ Approver A ─┐
  ├─→ Approver B ─┼─→ All must approve
  └─→ Approver C ─┘
  ↓
Provision

Configuration:
approvalMode: PARALLEL
approvalScheme: Could be OWNER (if multiple owners)

Example:
Request: Multi-system access role
Contains: AD access, Salesforce access, SAP access
Parallel approvers:
├─→ AD Owner (approves in 1 hour)
├─→ Salesforce Owner (approves in 3 hours)
└─→ SAP Owner (approves in 2 hours)

Total time: 3 hours (longest individual)
All 3 must approve for provisioning
Any 1 denial: Entire request fails
```

**When to use PARALLEL:**
```
Best for:
- Multiple independent reviewers
- No hierarchy between approvers
- Faster approval needed
- Multi-component access requests

Advantages:
✓ Faster (maximum of longest, not sum)
✓ Multiple expert opinions simultaneously
✓ Reduced total cycle time

Disadvantages:
✗ All still must approve (any denial fails request)
✗ Coordination challenges if changes needed
✗ Potential for conflicting feedback
```

---

**Mode 3: SINGLE (Any)**
```
Description: First approver to decide determines outcome
Characteristic: Multiple approvers, first response wins

Visual flow:
Request
  ↓
  ├─→ Approver A ─┐
  ├─→ Approver B ─┼─→ First to decide wins
  └─→ Approver C ─┘
  ↓
Provision (if first decision = approve)

Configuration:
approvalMode: SINGLE
Typically used with: GOVERNANCE_GROUP

Example:
Request: After-hours VPN access
Governance group: "Network Admin Team"
Members: [admin1, admin2, admin3]
All 3 notified simultaneously
admin2 approves first (within 30 minutes)
Result: Request approved (admin1 and admin3 no longer need to review)

If admin1 had denied first:
→ Request denied (admin2 and admin3 no longer need to review)
```

**When to use SINGLE:**
```
Best for:
- Governance groups
- Team-based approvals
- High availability requirements (someone always available)
- Urgent requests

Advantages:
✓ Fastest (first available approver)
✓ No single point of failure
✓ Workload distribution

Disadvantages:
✗ Inconsistent reviewers (different people each time)
✗ Potential for "easy approver" bias
✗ Less oversight (only one person reviews)
```

---

### Work Item Creation and Routing

#### Work Item Basics

**What is a work item?**
```
Definition: Task created in ISC representing approval needed
Appears in: Approver's "My Work" section
Contains: All information needed to make approval decision
Lifecycle: Created → Pending → Completed (Approved/Denied)
```

**Work item components:**
```json
{
  "workItemId": "WI-2024-12345",
  "type": "Approval",
  "requestId": "AR-2024-01234",
  "requester": "john.smith",
  "requestedFor": "john.smith",
  "requestedItems": [
    {
      "type": "ROLE",
      "name": "VPN Access",
      "id": "2c91808b..."
    }
  ],
  "approver": "mike.manager",
  "approverType": "MANAGER",
  "created": "2024-02-15T10:31:00Z",
  "dueDate": "2024-02-17T10:31:00Z",
  "priority": "Normal",
  "status": "Pending"
}
```

---

#### Work Item Routing Logic

**Step-by-step routing:**

**Step 1: Approval scheme determines approver type**
```
Scheme: MANAGER_OWNER
Level 1: MANAGER
Level 2: OWNER

For this request:
Level 1 approver type = MANAGER
Level 2 approver type = OWNER
```

**Step 2: Approver resolution**
```
Level 1 (MANAGER):
  Requester: john.smith
  Lookup: john.smith.manager
  Value: "mike.manager"
  Resolved approver: mike.manager

Level 2 (OWNER):
  Requested: "VPN Access" role
  Lookup: vpn-access-role.owner
  Value: "network.admin"
  Resolved approver: network.admin
```

**Step 3: Work item creation**
```
Level 1 work item:
  Created for: mike.manager
  Status: Pending
  Contains: Request details, requester info, items requested

Level 2 work item:
  Created for: network.admin
  Status: Not yet created (waiting for Level 1)
  Will be created: After Level 1 approves
```

**Step 4: Notification**
```
Email sent to: mike.manager
Subject: "Access Request Pending Your Approval"
Content: Request details, approve/deny links
In-app: Work item appears in mike.manager's "My Work"
```

---

### Decision Processing Flow

#### Approval Decision

**When approver approves:**
```
Step 1: Approver clicks "Approve"
Step 2: Optional comment entered
Step 3: Decision recorded
  {
    "decision": "Approved",
    "approver": "mike.manager",
    "timestamp": "2024-02-15T14:30:00Z",
    "comments": "Approved for remote work policy"
  }
Step 4: Work item status updated to "Approved"
Step 5: Determine next action
  If more approval levels:
    → Create work item for next level approver
    → Notify next approver
  If final approval level:
    → Create provisioning plan
    → Start provisioning process
```

**When approver denies:**
```
Step 1: Approver clicks "Deny"
Step 2: Required comment entered
Step 3: Decision recorded
  {
    "decision": "Denied",
    "approver": "mike.manager",
    "timestamp": "2024-02-15T14:30:00Z",
    "comments": "User no longer remote worker, not needed"
  }
Step 4: Work item status updated to "Denied"
Step 5: Entire request rejected
  - No further approval levels processed
  - No provisioning occurs
  - Requester notified of denial with reason
  - Request closed
```

---

### Timeout and Fallback Handling

#### Approval Timeouts

**Timeout configuration:**
```
Setting: Approval timeout = 48 hours
Meaning: If approver doesn't respond within 48 hours, timeout action triggers

Timeout action options:
1. Auto-approve (risky, not recommended)
2. Auto-deny (conservative, safe)
3. Escalate to fallback approver
4. Escalate to approver's manager
5. Leave pending (manual intervention)
```

**Escalation example:**
```
Request sent to: mike.manager
Timeout: 48 hours
After 48 hours: mike.manager hasn't responded

Escalation action: Forward to fallback approver
Fallback approver: director.level
Result: Work item reassigned to director.level
Notification: Both mike.manager and director.level notified
New timeout: Another 48 hours for director.level
```

---

#### Fallback Approvers

**When fallback is used:**
```
Scenario 1: Primary approver not found
  Requester manager attribute = null
  → Use fallback approver

Scenario 2: Primary approver inactive
  Manager identity status = Inactive
  → Use fallback approver

Scenario 3: Timeout
  Primary approver didn't respond in time
  → Use fallback approver

Scenario 4: Primary approver unavailable
  Manager on extended leave
  → Use fallback approver (if configured for absence)
```

**Fallback configuration:**
```
Global fallback: governance.admin
  Applied when: No other fallback specified
  Use: Last resort approver

Role-specific fallback: For "VPN Access" role
  Primary owner: network.admin
  Fallback owner: network.manager
  Use: When network.admin unavailable

Department fallback: For Finance department
  Primary: finance.manager
  Fallback: finance.director
  Use: Departmental escalation path
```

---

### Exam Tips

**Key concepts tested:**
✅ Approver types (MANAGER, OWNER, SOURCE_OWNER, GOVERNANCE_GROUP, WORKFLOW)
✅ Approval schemes (MANAGER, OWNER, MANAGER_OWNER, etc.)
✅ Approval modes (SEQUENTIAL, PARALLEL, SINGLE)
✅ Work item lifecycle
✅ Decision flow (approve vs. deny)
✅ Timeout handling
✅ Fallback approver usage

**Common exam scenarios:**
- Identify appropriate approver type for scenario
- Choose correct approval scheme for requirements
- Determine approval mode (sequential vs. parallel)
- Calculate total approval time
- Troubleshoot "no approver found" issues
- Understand fallback approver logic

**Remember:**
- MANAGER = Business validation
- OWNER = Technical validation  
- SEQUENTIAL = One at a time (slower, hierarchical)
- PARALLEL = Simultaneous (faster, all must still approve)
- MANAGER_OWNER = Most common multi-level scheme
- Timeout requires fallback or escalation configuration
- Denial at any level = entire request fails
- Work items appear in "My Work" section

---

### Key Takeaways

✅ **Five approver types** - MANAGER, OWNER, SOURCE_OWNER, GOVERNANCE_GROUP, WORKFLOW

✅ **Approval scheme** - Defines WHO approves (which approver types, how many levels)

✅ **Approval mode** - Defines HOW approvers approve (sequential, parallel, single)

✅ **Work items** - Tasks created for approvers, appear in "My Work"

✅ **Decision flow** - Approve continues chain, Deny stops immediately

✅ **Timeouts** - Configurable with escalation or fallback actions

✅ **Fallback approvers** - Used when primary approver unavailable or not found

✅ **Sequential vs Parallel** - Sequential = hierarchical/slower, Parallel = simultaneous/faster

---

**Next Section:** 7.2.2 - Approval Chains and Escalation - We'll cover multi-level approval configuration, escalation paths, SLA management, and complex approval scenarios.
